<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Guide du développeur MetPX-Sarracenia &mdash; Sarracenia 3.00.55rc1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="../../_static/sarra_horror_culture_favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=8b3d6455"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Normes de documentation" href="Documentation.html" />
    <link rel="prev" title="Contribuer à Sarracenia" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Sarracenia
              <img src="../../_static/sarra_horror_culture_w200.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.00.55rc1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../Explanation/Overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../How2Guides/index.html">HOWTOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Explanation/index.html">Explanation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Contribution/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-documentation.html">API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">En français</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Reference/index.html">Référence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Explication/index.html">Explication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Tutoriel/index.html">Tutoriel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../CommentFaire/index.html">Comment Faire</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Contribuer à Sarracenia</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Guide du développeur MetPX-Sarracenia</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#outillage">Outillage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#documentation">Documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#developpement">Développement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installation-locale">Installation locale</a></li>
<li class="toctree-l4"><a class="reference internal" href="#description-des-tests-sr-insects">Description des Tests sr_insects</a></li>
<li class="toctree-l4"><a class="reference internal" href="#execution-de-tests-de-flux">Exécution de tests de Flux</a></li>
<li class="toctree-l4"><a class="reference internal" href="#commits-vers-la-branche-principale">Commits vers la branche principale</a></li>
<li class="toctree-l4"><a class="reference internal" href="#branches-principales">Branches Principales</a></li>
<li class="toctree-l4"><a class="reference internal" href="#depots-de-pacquets-ubuntu-launchpad-net">Dépots de pacquets Ubuntu: Launchpad.net</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conventions">Conventions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ajout-d-un-dependence">Àjout d´un Dépendence</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Documentation.html">Normes de documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="Publication.html">Publier une Version de MetPX-Sarracenia</a></li>
<li class="toctree-l3"><a class="reference internal" href="mod%C3%A8le_de_page_man.html">SR3_TITRE</a></li>
<li class="toctree-l3"><a class="reference internal" href="v03.html">Refactorisation de la version 3</a></li>
<li class="toctree-l3"><a class="reference internal" href="Id%C3%A9eDeBase.html">Original (2015) Idée de base</a></li>
<li class="toctree-l3"><a class="reference internal" href="Design.html">Design original (2015)</a></li>
<li class="toctree-l3"><a class="reference internal" href="%C3%89volution.html">Changements de conception depuis l’original (2015)</a></li>
<li class="toctree-l3"><a class="reference internal" href="AMQPprimer.html">AMQP - Introduction à sarracénia</a></li>
<li class="toctree-l3"><a class="reference internal" href="probl%C3%A8mes_mqtt.html">Notes de mise en œuvre MQTT</a></li>
<li class="toctree-l3"><a class="reference internal" href="deltas.html">Discussion sur la propagation de la modification de fichiers</a></li>
<li class="toctree-l3"><a class="reference internal" href="assemblage_on_part.html">Réassemblage de fichiers</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Sarracenia</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">S´abonner et répliquer</a></li>
          <li class="breadcrumb-item"><a href="index.html">Contribuer à Sarracenia</a></li>
      <li class="breadcrumb-item active">Guide du développeur MetPX-Sarracenia</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/fr/Contribution/Développement.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="guide-du-developpeur-metpx-sarracenia">
<h1>Guide du développeur MetPX-Sarracenia<a class="headerlink" href="#guide-du-developpeur-metpx-sarracenia" title="Link to this heading"></a></h1>
<dl class="field-list simple">
<dt class="field-odd">version<span class="colon">:</span></dt>
<dd class="field-odd"><p>3.00.55rc1</p>
</dd>
<dt class="field-even">date<span class="colon">:</span></dt>
<dd class="field-even"><p>Sep 10, 2024</p>
</dd>
</dl>
<section id="outillage">
<h2>Outillage<a class="headerlink" href="#outillage" title="Link to this heading"></a></h2>
<p>Pour contribuer à la source Sarracenia, vous avez besoin de:</p>
<ul class="simple">
<li><p>Un environnement de développement Linux, soit un poste de travail, soit une machine virtuelle quelconque.
La configuration à l’aide d’Ubuntu est automatisée, mais un ajustement pour d’autres distributions est possible.
Le confort en ligne de commande est un must.</p></li>
<li><p>python3. L’application est développée en Python et dépend des versions python &gt;= 3.6.</p></li>
<li><p>style: PEP8 sauf que la longueur maximale de la ligne est de 119, appliquée via
<a class="reference external" href="https://pycodestyle.pycqa.org/en/latest/intro.html#disclaimer">pycodestyle</a>
pour VSCode, yapf3 ou un autre outil similaire.</p></li>
<li><p>Un compte sur github.com aidera à soumettre des patches.</p></li>
</ul>
<p>Les éléments qui seront installés par configuration automatisée :</p>
<ul class="simple">
<li><p>un tas d’autres modules python indiqués dans les dépendances (setup.py ou debian/control)</p></li>
<li><p>Module Pyftpdlib python3, utilisé pour exécuter un serveur ftp sur un port élevé pendant le test de flux.</p></li>
<li><p>git. afin de télécharger la source à partir du dépôt GitHub, et de préparer et soumettre
changements.</p></li>
<li><p>Un courtier RabbitMQ dédié, avec accès administratif, pour exécuter les tests sr_insects.
Ceci est installé par des outils automatisés pour configurer l’environnement Linux.
Le test de flux crée et détruit les échanges et perturbera tous les flux actifs sur le courtier.</p></li>
</ul>
<p>après avoir cloné le code source:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">-</span><span class="n">b</span> <span class="n">development</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">MetPX</span><span class="o">/</span><span class="n">sarracenia</span> <span class="n">sr3</span>
<span class="n">git</span> <span class="n">clone</span> <span class="o">-</span><span class="n">b</span> <span class="n">development</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">MetPX</span><span class="o">/</span><span class="n">sarrac</span> <span class="n">metpx</span><span class="o">-</span><span class="n">sr3c</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">MetPX</span><span class="o">/</span><span class="n">sr_insects</span> <span class="n">insects</span>
<span class="n">cd</span> <span class="n">sr3</span>
</pre></div>
</div>
<p>Le reste du guide suppose que vous y êtes.</p>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading"></a></h2>
<p><a class="reference internal" href="Documentation.html"><span class="doc">Normes de documentation</span></a> existent dans /docs/Contribution/Documentation.rst.
Le processus pour la construction locale des documents sont là, ainsi que les méthodes
de maintenance du site Web en direct.</p>
<section id="ou-documenter-les-options">
<h3>Où documenter les options<a class="headerlink" href="#ou-documenter-les-options" title="Link to this heading"></a></h3>
<p>Les options sont documentées dans le style de dictionnaire sr3_options(7) par ordre alphabétique.
Si cela en valait la peine, des exemples d’utilisation pourraient être ajoutés à d’autres guides.</p>
</section>
</section>
<section id="developpement">
<h2>Développement<a class="headerlink" href="#developpement" title="Link to this heading"></a></h2>
<p>En général, le flux de travail de développement consiste à obtenir un ordinateur portable ou une machine
virtuelle où l’on peut exécuter les flow_tests (disponible auprès de <a class="reference external" href="http://github.com/MetPX/sr_insects">http://github.com/MetPX/sr_insects</a> ).
La première étape lors de la configuration d’un environnement de développement s’agit de s’assurer que les
tests de flux sr_insects fonctionnent, car ils fonctionnent comme une porte d’entrée pour les commits
dans les branches importantes.</p>
<p>Le développement est le plus souvent effectué sur la plate-forme Ubuntu &gt; = 18.04.</p>
<section id="flux-de-travail-v2">
<h3>Flux de travail v2<a class="headerlink" href="#flux-de-travail-v2" title="Link to this heading"></a></h3>
<p>Le travail de développement terminé pour la version 2 est engagé sur la branche v2_dev, qui est utilisée
pour produire des instantanés quotidiens. On ne devrait normalement pas engager de changements dans la
direction v2_dev, mais plutôt les fusionner à partir d’une branche de travail.</p>
<p>Les directions générales du développement sont nommées d’après la question qu’elles sont censées aborder
“v2_issue365”, par exemple. S’il y a plusieurs tentatives pour résoudre un problème donné, utilisez le problème
comme préfixe de nom. Par exemple, il pourrait y avoir issue365, mais si nous décidons que ce n’est pas
une bonne façon d’aborder le problème, il pourrait y avoir une direction issue365_methodB.</p>
<p><strong>Avant de soumettre une demande d’extraction (Pull Request, PR), veuillez vous assurer que les tests de flow de
sr_insects ont été exécutés avec succès : au moins static_flow, flakey_broker et dynamic_flow</strong></p>
<p>Lorsqu’un PR est généré, le deuxième développeur peut l’examiner pour détecter des préoccupations.
Une fois satisfait de la nature du correctif, le deuxième développeur doit retirer la branche
et exécutez à nouveau les tests de flux (les trois mêmes) pour confirmer.  Seulement après que les tests de flux
ont été exécutés sur plusieurs machines qu’on peut ensuite fusionner avec stable.</p>
<p>Les problèmes propres à la v2 doivent être étiquetés <em>v2only</em>.
sur Launchpad.net :</p>
<ul class="simple">
<li><p>Les paquets de référentiel quotidiens de v2 seront construits à partir de v2_dev</p></li>
<li><p>Les paquets de référentiel de pré-version de v2 seront construits à partir de v2_dev</p></li>
<li><p>Les packages de référentiel de versions sont générés à partir de v2_stable.</p></li>
</ul>
</section>
<section id="flux-de-travail-v3">
<h3>Flux de travail v3<a class="headerlink" href="#flux-de-travail-v3" title="Link to this heading"></a></h3>
<p>La prochaine version de Sarracenia est développée dans la branche development (travail en cours).
Comme la refactorisation majeure est pratiquement terminée, le travail restant est maintenant entièrement constructif
et tout le développement est coordonné par des issues exactement comme l’est la V2. Les problèmes propres à la v3
sont les régressions ou améliorations qui n’ont pas de sens à ajouter à v2, ont la balise <em>v3only</em>.
Les problèmes communs entre les versions sont marqués <em>v3</em>.</p>
<p>Le flux de travail avec v3 est similaire à v2 mais avec des branches différentes.
Avoir tous les tests de flux
complétés avec assez de succès est un des critères d’acceptation dans development.</p>
<p>Pour exécuter les tests sr_insects, le référentiel doit être cloné avec la branche development.
Une porte pour la fusion à development est pour un deuxième développeur d’exécuter le flow_tests.
<strong>Pour la v03, ces tests doivent exécuter : static_flow, flakey_broker, dynamic_flow, transform_flow</strong></p>
<p>Prévu d’ici le 11/04/2022:</p>
<ul class="simple">
<li><p>Main sera fusionné à partir de development, donc la branche par défaut pour les nouveaux arrivants sera SR3.</p></li>
<li><p>Launchpad aura de nouvelles recettes pour produire des paquets SR3 à partir de la branche principale.</p></li>
</ul>
</section>
<section id="sr-insects">
<h3>sr_insects<a class="headerlink" href="#sr-insects" title="Link to this heading"></a></h3>
<p>Le référentiel sr_insects a sa propre base de données de problèmes, et le travail sur sr_insects est encouragé.
Les versions 2 et 3 sont prises en charge sur la branche principale de sr_insects. Cette branche devrait être
utilisé pour prendre en charge tout le développement dans les deux versions…</p>
</section>
<section id="tests-unitaires">
<h3>Tests unitaires<a class="headerlink" href="#tests-unitaires" title="Link to this heading"></a></h3>
<p>Le sous-répertoire tests/ contient un ensemble malheureusement incomplet mais croissant de tests unitaires
qui utilisent le framework <em>pytest</em>. Ces tests requiert Ubuntu 22.04 pour le moment.
Consultez tests/README.md pour savoir comment les exécuter. Réussite des tests unitaires (ou une très bonne explication
pourquoi ils échouent <em>temporairement</em>) devrait être une autre porte avant de fusionner avec la branche <em>developpement</em> principale.</p>
</section>
</section>
<section id="installation-locale">
<h2>Installation locale<a class="headerlink" href="#installation-locale" title="Link to this heading"></a></h2>
<p>Il existe de nombreuses façons d’installer des paquets python sur un ordinateur. Différents développeurs
préféreront différentes méthodes, et toutes les méthodes doivent être testées avant chaque version.
Avant d´installer le paquet il faut généralement une librarie pour communiquer avec le courtier
de messages (généralement rabbitmq/AMQP, mais ca peut être MQTT également)</p>
<ul class="simple">
<li><p><strong>Wheel</strong> Lorsque les gens utilisent différents systèmes d’exploitation (non-Ubuntu, non-Debian),
les gens installent des wheel, généralement qui ont été téléchargées sur pypi.python.org.  D’un
autre côté, c’est un peu pénible / bruyant de télécharger chaque version de développement, donc
nous ne téléchargeons que des versions, donc les tests de wheel se font en construisant des roues
locales. Besoin de construire une nouvelle wheel chaque fois qu’un changement est apporté.
<em>pip install amqp</em> sera également nécessaire pour le support rabbitmq.</p></li>
<li><p><strong>pip install (pas -e)</strong> tirerait une wheel vers le bas de pypi.python.org. Généralement pas utilisé
pendant le développement de Sarracenia lui-même.
<em>pip install amqp</em> sera également nécessaire pour le support rabbitmq.</p></li>
<li><p><strong>pip install -e</strong> … vous permet de modifier le code source du package installé, idéal pour les
problèmes de débogage, car il permet des modifications en direct de l’application sans avoir à passer
par la construction et l’installation d’un nouveau package.
<em>pip install amqp</em> sera également nécessaire pour le support rabbitmq.</p></li>
<li><p><strong>apt install</strong> installer le paquet Debian à partir de dépôts, de la même manière que pip install (pas -e),
normalement les instantanés de développement ne sont pas téléchargés vers des dépôts, donc bien que ce soit
la manière normale pour les utilisateurs de serveurs Ubuntu, il n’est pas disponible pendant le développement
du paquet lui-même.
<em>apt install python3-amqp</em> sera également nécessaire pour le support rabbitmq.</p></li>
<li><p><strong>dpkg -i</strong> construit un paquet Debian pour l’installation locale. C’est ainsi que les packages sont testés
avant d’être téléchargés vers des référentiels.  Il peut également être utilisé pour soutenir le développement
(il faut exécuter dpkg -i pour chaque changement de paquet).
<em>apt install python3-amqp</em> sera également nécessaire pour le support rabbitmq.</p></li>
</ul>
<p>Le test sr_insects appelle la version de metpx-sarracenia installée sur le système,
et non ce qui est dans l’arbre de développement.  Il est nécessaire d’installer le paquet sur
le système afin qu’il exécute les tests sr_insects.</p>
<section id="preparer-une-machine-virtuelle-vanilla">
<h3>Préparer une machine virtuelle Vanilla<a class="headerlink" href="#preparer-une-machine-virtuelle-vanilla" title="Link to this heading"></a></h3>
<p>Cette section décrit la création d’un environnement de test à utiliser dans un ordinateur virtuel. Une façon de
construire une machine virtuelle est d’utiliser Multipass (<a class="reference external" href="https://multipass.run">https://multipass.run</a>) En supposant que ce soit
installé, on peut crée une machine virtuelle avec</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">multipass</span> <span class="n">launch</span> <span class="o">-</span><span class="n">m</span> <span class="mi">8</span><span class="n">G</span> <span class="o">-</span><span class="n">d</span> <span class="mi">30</span><span class="n">G</span> <span class="o">--</span><span class="n">name</span> <span class="n">flow</span>
</pre></div>
</div>
<p>Vous devez faire fonctionner SSH LocalHost dans le conteneur MultiPass.  Peut le faire en copiant la clé privée
multipasse dans le conteneur:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fractal</span><span class="o">%</span> <span class="n">multipass</span> <span class="nb">list</span>
<span class="n">Name</span>                    <span class="n">State</span>             <span class="n">IPv4</span>             <span class="n">Image</span>
<span class="n">primary</span>                 <span class="n">Stopped</span>           <span class="o">--</span>               <span class="n">Ubuntu</span> <span class="mf">20.04</span> <span class="n">LTS</span>
<span class="n">flow</span>                    <span class="n">Running</span>           <span class="mf">10.23.119.56</span>     <span class="n">Ubuntu</span> <span class="mf">20.04</span> <span class="n">LTS</span>
<span class="n">keen</span><span class="o">-</span><span class="n">crow</span>               <span class="n">Running</span>           <span class="mf">10.23.119.5</span>      <span class="n">Ubuntu</span> <span class="mf">20.04</span> <span class="n">LTS</span>
<span class="n">fractal</span><span class="o">%</span>
</pre></div>
</div>
<p>Problèmes étranges avec les clés ssh qui ne sont pas interprétées correctement par paramiko, solution de contournement,
( <a class="reference external" href="https://stackoverflow.com/questions/54612609/paramiko-not-a-valid-rsa-private-key-file">https://stackoverflow.com/questions/54612609/paramiko-not-a-valid-rsa-private-key-file</a> )</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>fractal% sudo cat /var/snap/multipass/common/data/multipassd/ssh-keys/id_rsa | sed &#39;s/BEGIN .*PRIVATE/BEGIN RSA PRIVATE/;s/END .*PRIVATE/END RSA PRIVATE/&#39; &gt;id_rsa_container
chmod 600 id_rsa_container
scp -i id_rsa_container id_rsa_container ubuntu@10.23.119.175:/home/ubuntu/.ssh/id_rsa
                                                                  100% 1704     2.7MB/s   00:00

fractal% scp -i id_rsa_container id_rsa_container ubuntu@10.23.119.106:/home/ubuntu/.ssh/id_rsa
The authenticity of host &#39;10.23.119.106 (10.23.119.106)&#39; can&#39;t be established.
ECDSA key fingerprint is SHA256:jlRnxV7udiCBdAzCvOVgTu0MYJR5+kYzNwy/DIhkeD8.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added &#39;10.23.119.106&#39; (ECDSA) to the list of known hosts.
id_rsa_container                                                                                                                         100% 1712     9.4MB/s   00:00
fractal% multipass shell flow
Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-81-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Fri Aug 27 21:12:16 EDT 2021

  System load:  0.42              Processes:             112
  Usage of /:   4.4% of 28.90GB   Users logged in:       0
  Memory usage: 5%                IPv4 address for ens4: 10.23.119.106
  Swap usage:   0%


1 update can be applied immediately.
To see these additional updates run: apt list --upgradable


To run a command as administrator (user &quot;root&quot;), use &quot;sudo &lt;command&gt;&quot;.
See &quot;man sudo_root&quot; for details.

ubuntu@flow:~$
</pre></div>
</div>
<p>Invitez ensuite SSH à accepter la clé localhost:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ubuntu@flow:~$ ssh localhost ls -a
The authenticity of host &#39;localhost (127.0.0.1)&#39; can&#39;t be established.
ECDSA key fingerprint is SHA256:jlRnxV7udiCBdAzCvOVgTu0MYJR5+kYzNwy/DIhkeD8.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added &#39;localhost&#39; (ECDSA) to the list of known hosts.
.
..
.bash_logout
.bashrc
.cache
.profile
.ssh
ubuntu@flow:~$
</pre></div>
</div>
<p>Cela fournira un shell dans une machine virtuelle initialisée.  Pour le configurer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">-</span><span class="n">b</span> <span class="n">development</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">MetPX</span><span class="o">/</span><span class="n">sarracenia</span> <span class="n">sr3</span>
<span class="n">cd</span> <span class="n">sr3</span>
</pre></div>
</div>
<p>Il existe des scripts qui automatisent l’installation de l’environnement nécessaire pour pouvoir exécuter des tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">travis</span><span class="o">/</span><span class="n">flow_autoconfig</span><span class="o">.</span><span class="n">sh</span>
<span class="n">travis</span><span class="o">/</span><span class="n">add_sr3</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>ous devriez pouvoir voir une configuration vide:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr3</span> <span class="n">status</span>
</pre></div>
</div>
<p>SR3C et SR3 sont maintenant installés et devraient être prêts à exécuter un test de débit à partir du module
sr_insects, qui a également été cloné</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../</span><span class="n">sr_insects</span>
</pre></div>
</div>
<p>La branche v03 de sr_insects prend en charge les tests des versions 2 et 3, et les deux versions sont maintenant
installées. Les tests de flux sont destinés à être exécutés pour confirmer la compatibilité entre v2 et v3,
et donc doivent également pouvoir tester la V2</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ubuntu@flow:~/sr_insects$ dpkg -l | grep metpx
ii  metpx-libsr3c                    3.21.08a1-0~202108270410~ubuntu20.04.1 amd64        C-Implementation of a Sarracenia Client
ii  metpx-sarracenia                 2.21.08-0~202108241854~ubuntu20.04.1   all          Directory mirroring in real-time for users, file servers and web sites.
ii  metpx-sr3                        3.00.008exp                            all          v3 Directory mirroring in real-time for users, file servers and web sites.
ii  metpx-sr3c                       3.21.08a1-0~202108270410~ubuntu20.04.1 amd64        C-Implementation of a Sarracenia Client
ubuntu@flow:~/sr_insects$
</pre></div>
</div>
<p>Le paquet v2 est metpx-sarracenia, tandis que le paquet v3 est metpx-sr3. Les tests de débit détecteront
quelle version est installée et testera v3 si les deux sont présents.  Pour remplacer cela</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ubuntu@flow:~/sr_insects$ export sarra_py_version=2.21.08
ubuntu@flow:~/sr_insects$
</pre></div>
</div>
<p>Ensuite, on peut exécuter flow_tests à partir de ce shell normalement.</p>
</section>
<section id="python-wheel">
<h3>Python Wheel<a class="headerlink" href="#python-wheel" title="Link to this heading"></a></h3>
<p>Si vous n’avez pas utilisé add_sr3.sh (qui construit un paquet debian), alors on peut utiliser cette procédure
Pour une installation locale sur un ordinateur avec un Python Wheel pour les tests et le développement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">bdist_wheel</span>
</pre></div>
</div>
<p>ou… Sur les systèmes plus récents, utilisez build à la place</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">build</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">isolation</span>
</pre></div>
</div>
<p>Doit construire un Wheel dans le sous-répertoire dist.
Ensuite, en tant que root, installez ce nouveau paquet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip3</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="o">...&lt;</span><span class="n">path</span><span class="o">&gt;/</span><span class="n">dist</span><span class="o">/</span><span class="n">metpx</span><span class="o">*.</span><span class="n">whl</span>
</pre></div>
</div>
</section>
<section id="pip-install-locale">
<h3>Pip install locale<a class="headerlink" href="#pip-install-locale" title="Link to this heading"></a></h3>
<p>Pour une installation locale sur un ordinateur, à l’aide d’un pip.
Pour les tests et le développement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pip3 install -e .
export PATH=${HOME}/.local/bin:${PATH}
</pre></div>
</div>
<p>Utilisation du programme d’installation du package python local (PIP) pour créer une version modifiable localement.
Le code en dessus installera le paquet dans ~/.local/bin… Il faut donc s’assurer que le chemin comprend
ce répertoire.</p>
</section>
<section id="debian-ubuntu">
<h3>Debian/Ubuntu<a class="headerlink" href="#debian-ubuntu" title="Link to this heading"></a></h3>
<p>Pour une installation locale sur un ordinateur, en utilisant un paquet debian.
Ce processus construit un .deb local dans le répertoire parent en utilisant les mécanismes Debian standard.</p>
<ul>
<li><p>Vérifiez la ligne <strong>build-depends</strong> dans <em>debian/control</em> pour les dépendances qui pourraient être nécessaires
pour construire à partir de source.</p></li>
<li><p>Les étapes suivantes feront un build de sarracenia mais ne signeront pas les modifications ou le paquet source</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">metpx</span><span class="o">/</span><span class="n">sarracenia</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">devscripts</span>
<span class="n">debuild</span> <span class="o">-</span><span class="n">uc</span> <span class="o">-</span><span class="n">us</span>
<span class="n">sudo</span> <span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="o">../&lt;</span><span class="n">the</span> <span class="n">package</span> <span class="n">just</span> <span class="n">built</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
<p>qui accomplit la même chose en utilisant l’empaquetage Debian.
Les options sont détaillées ci-dessous :</p>
</section>
<section id="commit-de-code">
<h3>Commit de Code<a class="headerlink" href="#commit-de-code" title="Link to this heading"></a></h3>
<p>Que faut-il faire avant de s’engager dans la branche principale?
Liste de contrôle:</p>
<ul class="simple">
<li><p>faire du développement sur une autre branche. Habituellement, la branche sera nommée d’après le problème
adressée. Exemple : issue240. Si nous abandonnons une approche initiale et en commençons une autre,
il peut y avoir issue240_2 pour une deuxième tentative. Il peut également y avoir des branches de fonctionnalités,
telles que v03.</p></li>
<li><p><strong>Les tests sr_insects fonctionnent</strong> (Voir Tests) La branche principale doit toujours être fonctionnelle,
ne validez pas de code si les tests sr_insects ne fonctionnent pas.</p></li>
<li><p>Conséquence naturelle : si les changements de code signifient que les tests doivent changer, incluez le
changement de test dans le commit.</p></li>
<li><p><strong>Mettre à jour la doc/</strong> Les pages de manuel devraient idéalement recevoir leurs mises à jour en même temps
que le code.</p></li>
</ul>
<p>Habituellement, il y aura beaucoup de cycles de ce type sur une branche de développement avant que l’un d’eux
ne soit prêt à émettre une pull request. Finalement, nous arrivons à <a class="reference internal" href="#commits-vers-la-branche-principale">Commits vers la branche principale</a></p>
</section>
</section>
<section id="description-des-tests-sr-insects">
<h2>Description des Tests sr_insects<a class="headerlink" href="#description-des-tests-sr-insects" title="Link to this heading"></a></h2>
<p>Avant de valider du code dans la branche principale, en tant que mesure d’assurance qualité, il faut exécuter
tous les autotests disponibles. On suppose que les modifications spécifiques apportées au code ont déjà passé
les tests unitaires. Veuillez ajouter des autotests appropriés à ce processus pour refléter les nouveaux.
D’une manière générale, il faut résoudre les problèmes au premier test qui échoue parce que chaque test
est plus compliqué que le précédent.</p>
<p>Il existe un dépôt git séparé contenant les tests les plus complexes <a class="reference external" href="https://github.com/MetPX/sr_insects">https://github.com/MetPX/sr_insects</a></p>
<p>Un flux de travail de développement typique sera (N’essayez pas ceci, ceci est juste un aperçu des étapes qui seront
expliqué en détail dans les sections suivantes)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>git branch issueXXX
git checkout issueXXX
cd sarra ; *make coding changes*
cd ..
debuild -uc -us
cd ../sarrac
debuild -uc -us
sudo dpkg -i ../*.deb
cd ..

git clone -b development https://github.com/MetPX/sr_insects
cd sr_insects
sr3 status  # make sure there are no components configured before you start.
            # test results will likely be skewed otherwise.
for test in unit static_flow flakey_browser transform_flow dynamic_flow; do
   cd $test
   ./flow_setup.sh  # *starts the flows*
   ./flow_limit.sh  # *stops the flows after some period (default: 1000) *
   ./flow_check.sh  # *checks the flows*
   ./flow_cleanup.sh  # *cleans up the flows*
   cd ..
done

#assuming all the tests pass.
git commit -a  # on the branch...
</pre></div>
</div>
<section id="unit">
<h3>Unit<a class="headerlink" href="#unit" title="Link to this heading"></a></h3>
<p>Le test <em>unitaire</em> dans sr_insects est le plus court qui prend environ une minute et ne nécessite
pas beaucoup de configuration. Ce sont des tests de santé mentale du comportement du code. Prend
généralement une minute ou deux sur un ordinateur portable.</p>
</section>
<section id="static-flow">
<h3>Static Flow<a class="headerlink" href="#static-flow" title="Link to this heading"></a></h3>
<p>Les tests <em>static_flow</em> sont un peu plus compliqués, testant plus de composants, utilisant un seul
composants monothread de manière linéaire (toutes les données avancent uniformément.) Il devrait être
plus simple pour identifier les problèmes car il n’y a pas de suppression et donc cela se prête bien
à répéter des tests de sous-ensembles pour identifier les problèmes individuels. Cela prend environ
deux minutes sur un ordinateur portable.</p>
</section>
<section id="flakey-broker">
<h3>Flakey Broker<a class="headerlink" href="#flakey-broker" title="Link to this heading"></a></h3>
<p>Les tests <em>flakey_broker</em> sont les mêmes que les <em>static_flow</em>, mais ralentis de sorte qu’ils durent
quelques minutes de plus, et le courtier est arrêté et redémarré pendant que la publication se produit.
Notez que post_log imprime avant qu’un message de notification ne soit publié (parce que post_log est
un plugin on_post, et cette action, permet de modifier le message de notification, donc il doit être
avant que la publication ne se produise réellement.)</p>
</section>
<section id="dynamic-flow">
<h3>Dynamic Flow<a class="headerlink" href="#dynamic-flow" title="Link to this heading"></a></h3>
<p>Le test <em>dynamic_flow</em> ajoute des fonctionnalités avancées : multi-instances, le composant winnow,
les tests logiques de nouvelle tentative, et inclut également les suppressions de fichiers. La majeure
partie de la documentation ici fait référence à l’exécution du dynamic_flow test, car c’est le plus
compliqué, et l’ancêtre des autres.  Le test unitaire a été séparé du début du test dynamic_flow,
et le static_flow est une version simplifiée du test de flux original.</p>
<p>D’une manière générale, il convient d’exécuter les tests en séquence et de s’assurer que les résultats des tests
antérieurs soient sont bons avant de passer aux tests suivant.</p>
<p>Notez que le système de développement doit être configuré pour que les tests sr_insects s’exécutent correctement.
Voir la suite pour les instructions de configuration. Pour le développement avec une nouvelle installation du
système d’exploitation, les étapes de configuration ont été automatisées et peuvent être appliquées avec le
flow_autoconfig.sh dans sr_insects (<a class="reference external" href="https://github.com/MetPX/sr_insects/blob/stable/flow_autoconfig.sh">https://github.com/MetPX/sr_insects/blob/stable/flow_autoconfig.sh</a>).
L’exécution à l’aveugle de ce script sur un système fonctionnel peut entraîner des effets secondaires
indésirables; vous êtes prévenus !</p>
<p>La configuration que l’on essaie de répliquer :</p>
<img alt="../../_images/Flow_test.svg" src="../../_images/Flow_test.svg" />
<p>Le tableau suivant décrit ce que fait chaque élément du test de flux dynamique, et la couverture
du test montre les fonctionnalités couvertes.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Configuration</p></td>
<td><p>Fait</p></td>
<td><p>Couverture du test</p></td>
</tr>
<tr class="row-even"><td><p>subscribe t_ddx</p></td>
<td><p>copy from data mart to local broker
posting notification messages to
local xwinno00 and xwinnow01
exchanges.</p></td>
<td><p>lit le data mart public amqps (v02)
comme utilisateur ordinaire.</p>
<p>fil d’attente partagé et plusieurs
processus
3 instances téléchargent de chaque q
poster amqp à un échange local (v02)
en tant qu’utilisatuer feeder
(admin)
post_exchangeSplit à xwinnow0x</p>
</td>
</tr>
<tr class="row-odd"><td><p>winnow t0x_f10</p></td>
<td><p>traitement winnow qui publie pour
l’échange xsarra pour le
téléchargement.</p>
<p>Comme deux sources identiques
seulement la moitié des messages de
notifications sont postés au suivant</p>
</td>
<td><p>Lire l’AMQP v02 local
en tant qu’utilisateur de feeder.</p>
<p>Fonction de mise en cache complète
(Winnow)
post amqp v02 à l’échange local.</p>
</td>
</tr>
<tr class="row-even"><td><p>sarra download
f20</p></td>
<td><p>Téléchargez les données Winnowed à
partir du répertoire local data mart
(TESTDOCROOT= ~/sarra_devdocroot)</p>
<p>Ajouter un en-tête au niveau de la
couche d’application plus de 255
caractères.</p>
</td>
<td><p>Lire l’AMQP v02 local  (xsarra)</p>
<p>Télécharger à l’aide de Python
intégré
fil d’attente partagé et plusieurs
processus
5 instances téléchargent de chaque q
télécharge avec accel_wget plugin</p>
<p>Troncature d’en-tête AMQP lors de
la publication.
post amqp v02 à xpublic
en tant qu’utilisateur feeder
téléchargements HTTP depuis localhst</p>
</td>
</tr>
<tr class="row-odd"><td><p>subscribe t</p></td>
<td><p>Télécharge en tant que client à
partir de localhost au repertoire
downloaded_by_sub_t.</p></td>
<td><p>lire amqp du courtier local
en tant qu’utilisatuer/client
ordinaire.
fil d’attente partagé et plusieurs
processus
5 instances téléchargent de chaque q</p></td>
</tr>
<tr class="row-even"><td><p>watch f40</p></td>
<td><p>regarder downloaded_by_sub_t
Publier chaque fichier qui y apparaît</p>
<p>Plafond de mémoire réglé bas</p>
</td>
<td><p>client v03 post du fichier local.
(fichier: url)</p>
<p>Redémarrage automatique au plafond
de la mémoire.</p>
</td>
</tr>
<tr class="row-odd"><td><p>sender
tsource2send</p></td>
<td><p>lire fichier local, envoyer via sftp
au répertoire sent_by_tsource2send</p>
<p>Publier sur xs_tsource_output</p>
</td>
<td><p>client consomme des messages de
notification v03
Le consommateur lit le fichier local</p>
<p>envoyer via sftp.</p>
<p>plugin replace_dir</p>
<p>Affichage de l’URL sftp.
Post V02 (reconversion de V03.)</p>
<p>option test post_exchange_suffix.</p>
</td>
</tr>
<tr class="row-even"><td><p>subscribe
u_sftp_f60</p></td>
<td><p>Télécharger via sftp à partir de
localhost en plaçant les fichiers
dans le répertoire
downloaded_by_sub_u</p></td>
<td><p>Téléchargement SFTP client.</p>
<p>accel_sftp plugin.</p>
</td>
</tr>
<tr class="row-odd"><td><p>post test2_f61</p></td>
<td><p>Publier des fichiers dans
sent_by_tsource2send avec des URL
FTP dans l’échange xs_tsource_poll</p>
<p>(Wrapper Script appelle post)</p>
</td>
<td><p>Affichage explicite de fichiers</p>
<p>Publication d’URL ftp.</p>
<p>option post_exchange_suffix</p>
</td>
</tr>
<tr class="row-even"><td><p>poll f62</p></td>
<td><p>poller le répertoire
sent_by_tsource2send
publication d’URL de téléchargement
sftp</p></td>
<td><blockquote>
<div><p>polling</p>
</div></blockquote>
<p>option post_exchange_suffix</p>
</td>
</tr>
<tr class="row-odd"><td><p>subscribe ftp_f70</p></td>
<td><p>Abonnez-vous aux publications
test2_f61 FTP.
Télécharger des fichiers depuis
localhost au répertoire
downloaded_by_sub_u</p></td>
<td><p>Téléchargement d’URL FTP.</p></td>
</tr>
<tr class="row-even"><td><p>subscribe q_f71</p></td>
<td><p>s’abonner au sondage, téléchargement
sur recd_by_srpoll_test1</p></td>
<td><p>Confirmation de la qualité du poste
de poll</p></td>
</tr>
<tr class="row-odd"><td><p>shovel pclean f90</p></td>
<td><p>Nettoyez les fichiers pour qu’ils ne
s’accumulent pas
Simule les échecs pour forcer des
nouvelles tentatives</p></td>
<td><p>fonction shovel.</p>
<p>Logique de nouvelle tentative.</p>
</td>
</tr>
<tr class="row-even"><td><p>shovel pclean f91</p></td>
<td><p>Nettoyez les fichiers pour qu’ils ne
s’accumulent pas</p></td>
<td><p>shovel avec posting v03</p>
<p>Logique de nouvelle tentative.</p>
</td>
</tr>
<tr class="row-odd"><td><p>shovel pclean f92</p></td>
<td><p>Nettoyez les fichiers pour qu’ils ne
s’accumulent pas</p></td>
<td><p>shovel avec consommation v03</p>
<p>posting v02.</p>
<p>Logique de nouvelle tentative.</p>
</td>
</tr>
</tbody>
</table>
<p>Hypothèse: l’environnement de test est un PC Linux, soit un ordinateur portable/de bureau, soit un serveur sur lequel on
peut démarrer un navigateur. Si vous travaillez également avec l’implémentation C, il existe également les éléments suivants
Flux définis :</p>
<img alt="../../_images/cFlow_test.svg" src="../../_images/cFlow_test.svg" />
</section>
</section>
<section id="execution-de-tests-de-flux">
<h2>Exécution de tests de Flux<a class="headerlink" href="#execution-de-tests-de-flux" title="Link to this heading"></a></h2>
<p>Cette section documente ces étapes de manière beaucoup plus détaillée.
Avant de pouvoir effectuer les tests sr_insects, certaines conditions préalables doivent être prises en compte.
Notez qu’il existe une intégration Github Actions pour au moins la branche principale
pour vérifier la fonctionnalité sur une variété de versions de Python.  Consulter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">MetPX</span><span class="o">/</span><span class="n">sarracenia</span><span class="o">/</span><span class="n">actions</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pour les derniers résultats des tests. Notez que les résultats incluent des dizaines
de tests et sont peu fiables, il peut généralement falloir quelques tentatives pour
que cela fonctionne complètement (3 ou 4 échouent après la tentative initiale, puis
réexécutez les échecs, puis peut-être un ou deux resteront, et le troisième passe, et le dernier passe.)</p>
</div>
<section id="installer-des-serveurs-sur-un-poste-de-travail">
<h3>Installer des serveurs sur un poste de travail<a class="headerlink" href="#installer-des-serveurs-sur-un-poste-de-travail" title="Link to this heading"></a></h3>
<p>Pour préparer un ordinateur à exécuter le test de flux, il faut installer des logiciels et des
configurations serveur. Ce même travail est effectué par travis/flow_autoconfig.sh
qui est exécuté dans <a class="reference internal" href="#preparer-une-machine-virtuelle-vanilla">Préparer une machine virtuelle Vanilla</a> mais si vous devez le configurer
manuellement, voici le processus.</p>
<p>Installez un courtier localhost minimal et configurez les utilisateurs de test rabbitmq</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo apt-get install rabbitmq-server
sudo rabbitmq-plugins enable rabbitmq_management

mkdir ~/.config/sarra
cat &gt; ~/.config/sarra/default.conf &lt;&lt; EOF
declare env FLOWBROKER=localhost
declare env MQP=amqp
declare env SFTPUSER=${USER}
declare env TESTDOCROOT=${HOME}/sarra_devdocroot
declare env SR_CONFIG_EXAMPLES=${HOME}/git/sarracenia/sarra/examples
EOF

RABBITMQ_PASS=S0M3R4nD0MP4sS
cat &gt; ~/.config/sarra/credentials.conf &lt;&lt; EOF
amqp://bunnymaster:${RABBITMQ_PASS}@localhost/
amqp://tsource:${RABBITMQ_PASS}@localhost/
amqp://tsub:${RABBITMQ_PASS}@localhost/
amqp://tfeed:${RABBITMQ_PASS}@localhost/
amqp://anonymous:${RABBITMQ_PASS}@localhost/
amqps://anonymous:anonymous@hpfx.collab.science.gc.ca
amqps://anonymous:anonymous@hpfx1.collab.science.gc.ca
amqps://anonymous:anonymous@hpfx2.collab.science.gc.ca
amqps://anonymous:anonymous@dd.weather.gc.ca
amqps://anonymous:anonymous@dd1.weather.gc.ca
amqps://anonymous:anonymous@dd2.weather.gc.ca
ftp://anonymous:anonymous@localhost:2121/
EOF

cat &gt; ~/.config/sarra/admin.conf &lt;&lt; EOF
cluster localhost
admin amqp://bunnymaster@localhost/
feeder amqp://tfeed@localhost/
declare source tsource
declare subscriber tsub
declare subscriber anonymous
EOF

sudo rabbitmqctl delete_user guest

sudo rabbitmqctl add_user bunnymaster ${RABBITMQ_PASS}
sudo rabbitmqctl set_permissions bunnymaster &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;
sudo rabbitmqctl set_user_tags bunnymaster administrator

sudo systemctl restart rabbitmq-server
cd /usr/local/bin
sudo mv rabbitmqadmin rabbitmqadmin.1
sudo wget http://localhost:15672/cli/rabbitmqadmin
sudo chmod 755 rabbitmqadmin

sr3 --users declare
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Veuillez utiliser d’autres mots de passe dans les informations d’identification pour votre configuration, juste au cas où.
Les mots de passe ne doivent pas être hard-codés dans la suite d’autotests.
Les utilisateurs bunnymaster, tsource, tsub et tfeed doivent être utilisés pour exécuter des tests.</p>
<p>L’idée ici est d’utiliser tsource, tsub et tfeed comme comptes de courtier pour tous les
auto-test des opérations et stocker les informations d’identification dans le fichier credentials.conf normal.
Aucun mot de passe ou fichier clé ne doit être stocké dans l’arborescence source, dans le cadre d’une suite auto-test.</p>
</div>
</section>
<section id="configurer-lenvironnement-de-test-de-flux">
<h3>Configurer l’environnement de test de flux<a class="headerlink" href="#configurer-lenvironnement-de-test-de-flux" title="Link to this heading"></a></h3>
<p>Une fois l’environnement serveur établi, les tests de flux utilisent des transferts sftp vers localhost.</p>
<p>Il est également nécessaire que l’accès ssh sans mot de passe soit configuré sur l’hôte de test
pour l’utilisateur de système qui exécutera le test de flux. Cela peut être fait en créant une
paire de clés ssh privée/publique pour l’utilisateur (s’il n’y en a pas déjà) et en copiant la
clé publique dans le fichier authorized_keys dans le même répertoire que les clés (~/.ssh).
Pour les commandes associées, reportez-vous à la section <a class="reference external" href="http://www.linuxproblem.org/art_9.html">http://www.linuxproblem.org/art_9.html</a></p>
<p>Notez que sur les systèmes où les anciennes versions de Paramiko (&lt; 2.7.2) sont installées,
et où la paire de clés ssh a été générée avec OpenSSH &gt;= 6.5, tester manuellement la commande
ci-dessous fonctionnera, mais Paramiko ne pourra pas se connecter. C’est probablement le cas s
i le fichier <code class="docutils literal notranslate"><span class="pre">~/.ssh/id_rsa</span></code> contient <code class="docutils literal notranslate"><span class="pre">BEGIN</span> <span class="pre">OPENSSH</span> <span class="pre">PRIVATE</span> <span class="pre">KEY</span></code>. Pour contourner ce problème,
convertissez le format de la clé privée en utilisant <code class="docutils literal notranslate"><span class="pre">ssh-keygen</span> <span class="pre">-p</span> <span class="pre">-m</span> <span class="pre">PEM</span> <span class="pre">-f</span> <span class="pre">~/.ssh/id_rsa</span></code>.</p>
<p>Pour confirmer que ce ssh sans mot de passe vers localhost fonctionne</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">localhost</span> <span class="n">ls</span>
</pre></div>
</div>
<p>Cela devrait s’exécuter et se terminer.  S’il vous demande un mot de passe, les tests de flux ne fonctionneront pas.</p>
<p>Vérifiez que le courtier focntionne:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">status</span> <span class="n">rabbitmq</span><span class="o">-</span><span class="n">server</span>
</pre></div>
</div>
<p>Une partie du test de flux exécute un serveur sftp et utilise des fonctions client sftp.
Besoin du package suivant pour cela:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python3</span><span class="o">-</span><span class="n">pyftpdlib</span> <span class="n">python3</span><span class="o">-</span><span class="n">paramiko</span>
</pre></div>
</div>
<p>Le script d’installation démarre un serveur Web trivial, un serveur ftp et un démon que sr3_post appelle.
Il teste également les composants C, qui doivent également avoir déjà été installés.
et définit certains clients de test fixes qui seront utilisés lors des auto-tests</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd
git clone https://github.com/MetPX/sr_insects
cd sr_insects
cd static_flow
. ./flow_setup.sh

blacklab% ./flow_setup.sh
cleaning logs, just in case
rm: cannot remove &#39;/home/peter/.cache/sarra/log/*&#39;: No such file or directory
Adding flow test configurations...
2018-02-10 14:22:58,944 [INFO] copying /usr/lib/python3/dist-packages/sarra/examples/cpump/cno_trouble_f00.inc to /home/peter/.config/sarra/cpump/cno_trouble_f00.inc.
2018-02-10 09:22:59,204 [INFO] copying /home/peter/src/sarracenia/sarra/examples/shovel/no_trouble_f00.inc to /home/peter/.config/sarra/shovel/no_trouble_f00.inc
2018-02-10 14:22:59,206 [INFO] copying /usr/lib/python3/dist-packages/sarra/examples/cpost/veille_f34.conf to /home/peter/.config/sarra/cpost/veille_f34.conf.
2018-02-10 14:22:59,207 [INFO] copying /usr/lib/python3/dist-packages/sarra/examples/cpump/pelle_dd1_f04.conf to /home/peter/.config/sarra/cpump/pelle_dd1_f04.conf.
2018-02-10 14:22:59,208 [INFO] copying /usr/lib/python3/dist-packages/sarra/examples/cpump/pelle_dd2_f05.conf to /home/peter/.config/sarra/cpump/pelle_dd2_f05.conf.
2018-02-10 14:22:59,208 [INFO] copying /usr/lib/python3/dist-packages/sarra/examples/cpump/xvan_f14.conf to /home/peter/.config/sarra/cpump/xvan_f14.conf.
2018-02-10 14:22:59,209 [INFO] copying /usr/lib/python3/dist-packages/sarra/examples/cpump/xvan_f15.conf to /home/peter/.config/sarra/cpump/xvan_f15.conf.
2018-02-10 09:22:59,483 [INFO] copying /home/peter/src/sarracenia/sarra/examples/poll/f62.conf to /home/peter/.config/sarra/poll/f62.conf
2018-02-10 09:22:59,756 [INFO] copying /home/peter/src/sarracenia/sarra/examples/post/shim_f63.conf to /home/peter/.config/sarra/post/shim_f63.conf
2018-02-10 09:23:00,030 [INFO] copying /home/peter/src/sarracenia/sarra/examples/post/test2_f61.conf to /home/peter/.config/sarra/post/test2_f61.conf
2018-02-10 09:23:00,299 [INFO] copying /home/peter/src/sarracenia/sarra/examples/report/tsarra_f20.conf to /home/peter/.config/sarra/report/tsarra_f20.conf
2018-02-10 09:23:00,561 [INFO] copying /home/peter/src/sarracenia/sarra/examples/report/twinnow00_f10.conf to /home/peter/.config/sarra/report/twinnow00_f10.conf
2018-02-10 09:23:00,824 [INFO] copying /home/peter/src/sarracenia/sarra/examples/report/twinnow01_f10.conf to /home/peter/.config/sarra/report/twinnow01_f10.conf
2018-02-10 09:23:01,086 [INFO] copying /home/peter/src/sarracenia/sarra/examples/sarra/download_f20.conf to /home/peter/.config/sarra/sarra/download_f20.conf
2018-02-10 09:23:01,350 [INFO] copying /home/peter/src/sarracenia/sarra/examples/sender/tsource2send_f50.conf to /home/peter/.config/sarra/sender/tsource2send_f50.conf
2018-02-10 09:23:01,615 [INFO] copying /home/peter/src/sarracenia/sarra/examples/shovel/t_dd1_f00.conf to /home/peter/.config/sarra/shovel/t_dd1_f00.conf
2018-02-10 09:23:01,877 [INFO] copying /home/peter/src/sarracenia/sarra/examples/shovel/t_dd2_f00.conf to /home/peter/.config/sarra/shovel/t_dd2_f00.conf
2018-02-10 09:23:02,137 [INFO] copying /home/peter/src/sarracenia/sarra/examples/subscribe/cclean_f91.conf to /home/peter/.config/sarra/subscribe/cclean_f91.conf
2018-02-10 09:23:02,400 [INFO] copying /home/peter/src/sarracenia/sarra/examples/subscribe/cdnld_f21.conf to /home/peter/.config/sarra/subscribe/cdnld_f21.conf
2018-02-10 09:23:02,658 [INFO] copying /home/peter/src/sarracenia/sarra/examples/subscribe/cfile_f44.conf to /home/peter/.config/sarra/subscribe/cfile_f44.conf
2018-02-10 09:23:02,921 [INFO] copying /home/peter/src/sarracenia/sarra/examples/subscribe/clean_f90.conf to /home/peter/.config/sarra/subscribe/clean_f90.conf
2018-02-10 09:23:03,185 [INFO] copying /home/peter/src/sarracenia/sarra/examples/subscribe/cp_f61.conf to /home/peter/.config/sarra/subscribe/cp_f61.conf
2018-02-10 09:23:03,455 [INFO] copying /home/peter/src/sarracenia/sarra/examples/subscribe/ftp_f70.conf to /home/peter/.config/sarra/subscribe/ftp_f70.conf
2018-02-10 09:23:03,715 [INFO] copying /home/peter/src/sarracenia/sarra/examples/subscribe/q_f71.conf to /home/peter/.config/sarra/subscribe/q_f71.conf
2018-02-10 09:23:03,978 [INFO] copying /home/peter/src/sarracenia/sarra/examples/subscribe/t_f30.conf to /home/peter/.config/sarra/subscribe/t_f30.conf
2018-02-10 09:23:04,237 [INFO] copying /home/peter/src/sarracenia/sarra/examples/subscribe/u_sftp_f60.conf to /home/peter/.config/sarra/subscribe/u_sftp_f60.conf
2018-02-10 09:23:04,504 [INFO] copying /home/peter/src/sarracenia/sarra/examples/watch/f40.conf to /home/peter/.config/sarra/watch/f40.conf
2018-02-10 09:23:04,764 [INFO] copying /home/peter/src/sarracenia/sarra/examples/winnow/t00_f10.conf to /home/peter/.config/sarra/winnow/t00_f10.conf
2018-02-10 09:23:05,027 [INFO] copying /home/peter/src/sarracenia/sarra/examples/winnow/t01_f10.conf to /home/peter/.config/sarra/winnow/t01_f10.conf
Initializing with sr_audit... takes a minute or two
OK, as expected 18 queues existing after 1st audit
OK, as expected 31 exchanges for flow test created.
Starting trivial http server on: /home/peter/sarra_devdocroot, saving pid in .httpserverpid
Starting trivial ftp server on: /home/peter/sarra_devdocroot, saving pid in .ftpserverpid
running self test ... takes a minute or two
sr_util.py TEST PASSED
sr_credentials.py TEST PASSED
sr_config.py TEST PASSED
sr_cache.py TEST PASSED
sr_retry.py TEST PASSED
sr_consumer.py TEST PASSED
sr_http.py TEST PASSED
sftp testing start...
sftp testing config read...
sftp testing fake message built ...
sftp sr_ftp instantiated ...
sftp sr_ftp connected ...
sftp sr_ftp mkdir ...
test 01: directory creation succeeded
test 02: file upload succeeded
test 03: file rename succeeded
test 04: getting a part succeeded
test 05: download succeeded
test 06: onfly_checksum succeeded
Sent: bbb  into tztz/ddd 0-5
test 07: download succeeded
test 08: delete succeeded
Sent: bbb  into tztz/ddd 0-5
Sent: bbb  into tztz/ddd 0-5
Sent: bbb  into tztz/ddd 0-5
Sent: bbb  into tztz/ddd 0-5
Sent: bbb  into tztz/ddd 0-5
/home/peter
/home/peter
test 09: bad part succeeded
sr_sftp.py TEST PASSED
sr_instances.py TEST PASSED
OK, as expected 9 tests passed
Starting flow_post on: /home/peter/sarra_devdocroot, saving pid in .flowpostpid
Starting up all components (sr start)...
done.
OK: sr3 start was successful
Overall PASSED 4/4 checks passed!
blacklab%
</pre></div>
</div>
<p>Lorsqu’il exécute le programme d’installation, il exécute également tous les unit_tests existants.
Ne passez aux tests flow_check que si tous les tests de flow_setup.sh réussissent.</p>
</section>
<section id="executer-un-test-de-flux">
<h3>Exécuter un test de Flux<a class="headerlink" href="#executer-un-test-de-flux" title="Link to this heading"></a></h3>
<p>Le script flow_check.sh lit les fichiers journaux de tous les composants démarrés et compare
le nombre de messages de notification, à la recherche d’une correspondance dans les +- 10%.
Il faut quelques minutes pour que la configuration s’exécute avant qu’il y ait suffisamment
de données pour effectuer les mesures correctes</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">flow_limit</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>sample output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>initial sample building sample size 8 need at least 1000
sample now   1021
Sufficient!
stopping shovels and waiting...
2017-10-28 00:37:02,422 [INFO] sr_shovel t_dd1_f00 0001 stopping
2017-10-28 04:37:02,435 [INFO] 2017-10-28 04:37:02,435 [INFO] info: instances option not implemented, ignored.
info: instances option not implemented, ignored.
2017-10-28 04:37:02,435 [INFO] 2017-10-28 04:37:02,435 [INFO] info: report option not implemented, ignored.
info: report option not implemented, ignored.
2017-10-28 00:37:02,436 [INFO] sr_shovel t_dd2_f00 0001 stopping
running instance for config pelle_dd1_f04 (pid 15872) stopped.
running instance for config pelle_dd2_f05 (pid 15847) stopped.
    maximum of the shovels is: 1022
</pre></div>
</div>
<p>Ensuite, vérifiez avec flow_check.sh:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>TYPE OF ERRORS IN LOG :

  1 /home/peter/.cache/sarra/log/sr_cpump_xvan_f14_001.log [ERROR] binding failed: server channel error 404h, message: NOT_FOUND - no exchange &#39;xcvan00&#39; in vhost &#39;/&#39;
  1 /home/peter/.cache/sarra/log/sr_cpump_xvan_f15_001.log [ERROR] binding failed: server channel error 404h, message: NOT_FOUND - no exchange &#39;xcvan01&#39; in vhost &#39;/&#39;


test  1 success: shovels t_dd1_f00 ( 1022 ) and t_dd2_f00 ( 1022 ) should have about the same number of items read
test  2 success: sarra tsarra (1022) should be reading about half as many items as (both) winnows (2240)
test  3 success: tsarra (1022) and sub t_f30 (1022) should have about the same number of items
test  4 success: max shovel (1022) and subscriber t_f30 (1022) should have about the same number of items
test  5 success: count of truncated headers (1022) and subscribed messages (1022) should have about the same number of items
test  6 success: count of downloads by subscribe t_f30 (1022) and messages received (1022) should be about the same
test  7 success: downloads by subscribe t_f30 (1022) and files posted by sr3_watch (1022) should be about the same
test  8 success: posted by watch(1022) and sent by sr_sender (1022) should be about the same
test  9 success: 1022 of 1022: files sent with identical content to those downloaded by subscribe
test 10 success: 1022 of 1022: poll test1_f62 and subscribe q_f71 run together. Should have equal results.
test 11 success: post test2_f61 1022 and subscribe r_ftp_f70 1021 run together. Should be about the same.
test 12 success: cpump both pelles (c shovel) should receive about the same number of messages (3665) (3662)
test 13 success: cdnld_f21 subscribe downloaded (1022) the same number of files that was published by both van_14 and van_15 (1022)
test 14 success: veille_f34 should post the same number of files (1022) that subscribe cdnld_f21 downloaded (1022)
test 15 success: veille_f34 should post the same number of files (1022) that subscribe cfile_f44 downloaded (1022)
test 16 success: Overall 15 of 15 passed!

blacklab%
</pre></div>
</div>
<p>Si le flow_check.sh est adopté, alors on a une confiance raisonnable dans la fonctionnalité globale de
Python, mais la couverture du test n’est pas exhaustive. C’est la porte la plus basse pour s’engager
à des modifications apportées à votre code Python dans la branche principale. Il s’agit d’un échantillonnage plus qualitatif
des cas d’utilisation courants plutôt qu’un examen approfondi de toutes les fonctionnalités. Bien que ce ne soit pas le cas
approfondie, il est bon de savoir que les flux fonctionnent.</p>
<p>Notez que l’abonné <em>fclean</em> examine les fichiers et les conserve suffisamment longtemps pour qu’ils puissent
parcourir tous les autres tests.  Il le fait en attendant un délai raisonnable (45 secondes, la dernière fois
vérifiée), puis il compare le fichier qui a été posté par sr3_watch aux fichiers créés en téléchargeant à partir
de celui-ci.  Au fur et à mesure que le dénombrement <em>sample now</em> progresse, il imprime “OK” si les fichiers
téléchargés sont identiques à ceux postés par sr_watch. L’ajout de fclean et cfclean correspondant pour les
cflow_test sont cassés.  La configuration par défaut qui utilise <em>fclean</em> et <em>cfclean</em> garantit que seulement
quelques minutes d’espace disque sont utilisées à un moment donné et permettent des tests beaucoup plus longs.</p>
<p>Par défaut, le flow_test n’est que de 1000 fichiers, mais on peut lui demander de fonctionner plus longtemps,
comme ceci:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">flow_limit</span><span class="o">.</span><span class="n">sh</span> <span class="mi">50000</span>
</pre></div>
</div>
<p>Pour accumuler cinquante mille fichiers avant de terminer le test. Cela permet de tester les performances
à long terme, en particulier l’utilisation de la mémoire au fil du temps et des fonctions d’entretien
du traitement on_heartbeat.</p>
</section>
<section id="flow-cleanup">
<h3>Flow Cleanup<a class="headerlink" href="#flow-cleanup" title="Link to this heading"></a></h3>
<p>Une fois le test terminé, exécutez le script ./flow_cleanup.sh, qui tuera les serveurs et les démons en cours
d’exécution et supprimera tous les fichiers de configuration installés pour le test de flux, toutes les files
d’attente, les échanges et les journaux. Cela doit également être fait entre chaque exécution du test de flux:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>blacklab% ./flow_cleanup.sh
Stopping sr...
Cleanup sr...
Cleanup trivial http server...
web server stopped.
if other web servers with lost pid kill them
Cleanup trivial ftp server...
ftp server stopped.
if other ftp servers with lost pid kill them
Cleanup flow poster...
flow poster stopped.
if other flow_post.sh with lost pid kill them
Deleting queues:
Deleting exchanges...
Removing flow configs...
2018-02-10 14:17:34,150 [INFO] info: instances option not implemented, ignored.
2018-02-10 14:17:34,150 [INFO] info: report option not implemented, ignored.
2018-02-10 14:17:34,353 [INFO] info: instances option not implemented, ignored.
2018-02-10 14:17:34,353 [INFO] info: report option not implemented, ignored.
2018-02-10 09:17:34,837 [INFO] sr_poll f62 cleanup
2018-02-10 09:17:34,845 [INFO] deleting exchange xs_tsource_poll (tsource@localhost)
2018-02-10 09:17:35,115 [INFO] sr3_post shim_f63 cleanup
2018-02-10 09:17:35,122 [INFO] deleting exchange xs_tsource_shim (tsource@localhost)
2018-02-10 09:17:35,394 [INFO] sr3_post test2_f61 cleanup
2018-02-10 09:17:35,402 [INFO] deleting exchange xs_tsource_post (tsource@localhost)
2018-02-10 09:17:35,659 [INFO] sr_report tsarra_f20 cleanup
2018-02-10 09:17:35,659 [INFO] AMQP  broker(localhost) user(tfeed) vhost(/)
2018-02-10 09:17:35,661 [INFO] deleting queue q_tfeed.sr_report.tsarra_f20.89336558.04455188 (tfeed@localhost)
2018-02-10 09:17:35,920 [INFO] sr_report twinnow00_f10 cleanup
2018-02-10 09:17:35,920 [INFO] AMQP  broker(localhost) user(tfeed) vhost(/)
2018-02-10 09:17:35,922 [INFO] deleting queue q_tfeed.sr_report.twinnow00_f10.35552245.50856337 (tfeed@localhost)
2018-02-10 09:17:36,179 [INFO] sr_report twinnow01_f10 cleanup
2018-02-10 09:17:36,180 [INFO] AMQP  broker(localhost) user(tfeed) vhost(/)
2018-02-10 09:17:36,182 [INFO] deleting queue q_tfeed.sr_report.twinnow01_f10.48262886.11567358 (tfeed@localhost)
2018-02-10 09:17:36,445 [WARNING] option url deprecated please use post_base_url
2018-02-10 09:17:36,446 [WARNING] use post_base_dir instead of document_root
2018-02-10 09:17:36,446 [INFO] sr_sarra download_f20 cleanup
2018-02-10 09:17:36,446 [INFO] AMQP  broker(localhost) user(tfeed) vhost(/)
2018-02-10 09:17:36,448 [INFO] deleting queue q_tfeed.sr_sarra.download_f20 (tfeed@localhost)
2018-02-10 09:17:36,449 [INFO] exchange xpublic remains
2018-02-10 09:17:36,703 [INFO] sr_sender tsource2send_f50 cleanup
2018-02-10 09:17:36,703 [INFO] AMQP  broker(localhost) user(tsource) vhost(/)
2018-02-10 09:17:36,705 [INFO] deleting queue q_tsource.sr_sender.tsource2send_f50 (tsource@localhost)
2018-02-10 09:17:36,711 [INFO] deleting exchange xs_tsource_output (tsource@localhost)
2018-02-10 09:17:36,969 [INFO] sr_shovel t_dd1_f00 cleanup
2018-02-10 09:17:36,969 [INFO] AMQP  broker(dd.weather.gc.ca) user(anonymous) vhost(/)
2018-02-10 09:17:37,072 [INFO] deleting queue q_anonymous.sr_shovel.t_dd1_f00 (anonymous@dd.weather.gc.ca)
2018-02-10 09:17:37,095 [INFO] exchange xwinnow00 remains
2018-02-10 09:17:37,095 [INFO] exchange xwinnow01 remains
2018-02-10 09:17:37,389 [INFO] sr_shovel t_dd2_f00 cleanup
2018-02-10 09:17:37,389 [INFO] AMQP  broker(dd.weather.gc.ca) user(anonymous) vhost(/)
2018-02-10 09:17:37,498 [INFO] deleting queue q_anonymous.sr_shovel.t_dd2_f00 (anonymous@dd.weather.gc.ca)
2018-02-10 09:17:37,522 [INFO] exchange xwinnow00 remains
2018-02-10 09:17:37,523 [INFO] exchange xwinnow01 remains
2018-02-10 09:17:37,804 [INFO] sr_subscribe cclean_f91 cleanup
2018-02-10 09:17:37,804 [INFO] AMQP  broker(localhost) user(tsub) vhost(/)
2018-02-10 09:17:37,806 [INFO] deleting queue q_tsub.sr_subscribe.cclean_f91.39328538.44917465 (tsub@localhost)
2018-02-10 09:17:38,062 [INFO] sr_subscribe cdnld_f21 cleanup
2018-02-10 09:17:38,062 [INFO] AMQP  broker(localhost) user(tfeed) vhost(/)
2018-02-10 09:17:38,064 [INFO] deleting queue q_tfeed.sr_subscribe.cdnld_f21.11963392.61638098 (tfeed@localhost)
2018-02-10 09:17:38,324 [WARNING] use post_base_dir instead of document_root
2018-02-10 09:17:38,324 [INFO] sr_subscribe cfile_f44 cleanup
2018-02-10 09:17:38,324 [INFO] AMQP  broker(localhost) user(tfeed) vhost(/)
2018-02-10 09:17:38,326 [INFO] deleting queue q_tfeed.sr_subscribe.cfile_f44.56469334.87337271 (tfeed@localhost)
2018-02-10 09:17:38,583 [INFO] sr_subscribe clean_f90 cleanup
2018-02-10 09:17:38,583 [INFO] AMQP  broker(localhost) user(tsub) vhost(/)
2018-02-10 09:17:38,585 [INFO] deleting queue q_tsub.sr_subscribe.clean_f90.45979835.20516428 (tsub@localhost)
2018-02-10 09:17:38,854 [WARNING] extended option download_cp_command = [&#39;cp --preserve=timestamps&#39;] (unknown or not declared)
2018-02-10 09:17:38,855 [INFO] sr_subscribe cp_f61 cleanup
2018-02-10 09:17:38,855 [INFO] AMQP  broker(localhost) user(tsource) vhost(/)
2018-02-10 09:17:38,857 [INFO] deleting queue q_tsource.sr_subscribe.cp_f61.61218922.69758215 (tsource@localhost)
2018-02-10 09:17:39,121 [INFO] sr_subscribe ftp_f70 cleanup
2018-02-10 09:17:39,121 [INFO] AMQP  broker(localhost) user(tsource) vhost(/)
2018-02-10 09:17:39,123 [INFO] deleting queue q_tsource.sr_subscribe.ftp_f70.47997098.27633529 (tsource@localhost)
2018-02-10 09:17:39,386 [INFO] sr_subscribe q_f71 cleanup
2018-02-10 09:17:39,386 [INFO] AMQP  broker(localhost) user(tsource) vhost(/)
2018-02-10 09:17:39,389 [INFO] deleting queue q_tsource.sr_subscribe.q_f71.84316550.21567557 (tsource@localhost)
2018-02-10 09:17:39,658 [INFO] sr_subscribe t_f30 cleanup
2018-02-10 09:17:39,658 [INFO] AMQP  broker(localhost) user(tsub) vhost(/)
2018-02-10 09:17:39,660 [INFO] deleting queue q_tsub.sr_subscribe.t_f30.26453890.50752396 (tsub@localhost)
2018-02-10 09:17:39,924 [INFO] sr_subscribe u_sftp_f60 cleanup
2018-02-10 09:17:39,924 [INFO] AMQP  broker(localhost) user(tsource) vhost(/)
2018-02-10 09:17:39,927 [INFO] deleting queue q_tsource.sr_subscribe.u_sftp_f60.81353341.03950190 (tsource@localhost)
2018-02-10 09:17:40,196 [WARNING] option url deprecated please use post_base_url
2018-02-10 09:17:40,196 [WARNING] use post_broker to set broker
2018-02-10 09:17:40,197 [INFO] sr3_watch f40 cleanup
2018-02-10 09:17:40,207 [INFO] deleting exchange xs_tsource (tsource@localhost)
2018-02-10 09:17:40,471 [INFO] sr_winnow t00_f10 cleanup
2018-02-10 09:17:40,471 [INFO] AMQP  broker(localhost) user(tfeed) vhost(/)
2018-02-10 09:17:40,474 [INFO] deleting queue q_tfeed.sr_winnow.t00_f10 (tfeed@localhost)
2018-02-10 09:17:40,480 [INFO] deleting exchange xsarra (tfeed@localhost)
2018-02-10 09:17:40,741 [INFO] sr_winnow t01_f10 cleanup
2018-02-10 09:17:40,741 [INFO] AMQP  broker(localhost) user(tfeed) vhost(/)
2018-02-10 09:17:40,743 [INFO] deleting queue q_tfeed.sr_winnow.t01_f10 (tfeed@localhost)
2018-02-10 09:17:40,750 [INFO] deleting exchange xsarra (tfeed@localhost)
2018-02-10 14:17:40,753 [ERROR] config cno_trouble_f00 not found.
Removing flow config logs...
rm: cannot remove &#39;/home/peter/.cache/sarra/log/sr_audit_f00.log&#39;: No such file or directory
Removing document root ( /home/peter/sarra_devdocroot )...
Done!
</pre></div>
</div>
<p>Après la flow_cleanup.sh, pour vérifier qu’un test est terminé, utiliser:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sr3</span> <span class="n">status</span>
</pre></div>
</div>
<p>ce qui devrait montrer qu’il n’y a pas de configurations actives.</p>
<p>Si le test static_flow fonctionne, réexécutez les autres tests : flakey_broker,
transform_flow, et dynamic_flow.</p>
</section>
<section id="longueur-du-test-dynamic-flow">
<h3>Longueur du test Dynamic Flow<a class="headerlink" href="#longueur-du-test-dynamic-flow" title="Link to this heading"></a></h3>
<p>Alors que la plupart des tests ont une durée fixe, le test de flux dynamique interroge une serveur distant
et peut fonctionner pour n’importe quelle longueur souhaitée. La longueur du flow_test dynamique par défaut
est de 1000 fichiers circulant dans les cas de test. En cas de développement rapide,
on peut fournir un argument pour raccourcir cela:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">flow_limit</span><span class="o">.</span><span class="n">sh</span> <span class="mi">200</span>
</pre></div>
</div>
<p>Vers la fin d’un cycle de développement, des flow_tests plus longs sont conseillées:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">flow_limit</span><span class="o">.</span><span class="n">sh</span> <span class="mi">20000</span>
</pre></div>
</div>
<p>pour identifier plus de problèmes. Exemple d’exécution à 100 000 entrées</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>blacklab% ./flow_limit.sh 100000
initial sample building sample size 155 need at least 100000
sample now 100003 content_checks:GOOD missed_dispositions:0s:0
Sufficient!
stopping shovels and waiting...
2018-02-10 13:15:08,964 [INFO] 2018-02-10 13:15:08,964 [INFO] info: instances option not implemented, ignored.
info: instances option not implemented, ignored.
2018-02-10 13:15:08,964 [INFO] info: report option not implemented, ignored.
2018-02-10 13:15:08,964 [INFO] info: report option not implemented, ignored.
running instance for config pelle_dd2_f05 (pid 20031) stopped.
running instance for config pelle_dd1_f04 (pid 20043) stopped.
Traceback (most recent call last):ng...
  File &quot;/usr/bin/rabbitmqadmin&quot;, line 1012, in &lt;module&gt;
    main()
  File &quot;/usr/bin/rabbitmqadmin&quot;, line 413, in main
    method()
  File &quot;/usr/bin/rabbitmqadmin&quot;, line 593, in invoke_list
    format_list(self.get(uri), cols, obj_info, self.options)
  File &quot;/usr/bin/rabbitmqadmin&quot;, line 710, in format_list
    formatter_instance.display(json_list)
  File &quot;/usr/bin/rabbitmqadmin&quot;, line 721, in display
    (columns, table) = self.list_to_table(json.loads(json_list), depth)
  File &quot;/usr/bin/rabbitmqadmin&quot;, line 775, in list_to_table
    add(&#39;&#39;, 1, item, add_to_row)
  File &quot;/usr/bin/rabbitmqadmin&quot;, line 742, in add
    add(column, depth + 1, subitem, fun)
  File &quot;/usr/bin/rabbitmqadmin&quot;, line 742, in add
    add(column, depth + 1, subitem, fun)
  File &quot;/usr/bin/rabbitmqadmin&quot;, line 754, in add
    fun(column, subitem)
  File &quot;/usr/bin/rabbitmqadmin&quot;, line 761, in add_to_row
    row[column_ix[col]] = maybe_utf8(val)
  File &quot;/usr/bin/rabbitmqadmin&quot;, line 431, in maybe_utf8
    return s.encode(&#39;utf-8&#39;)
AttributeError: &#39;float&#39; object has no attribute &#39;encode&#39;
maximum of the shovels is: 100008
</pre></div>
</div>
<p>While it is runnig one can run flow_check.sh at any time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>NB retries for sr_subscribe t_f30 0
NB retries for sr_sender 18

      1 /home/peter/.cache/sarra/log/sr_cpost_veille_f34_0001.log [ERROR] sr_cpost rename: /home/peter/sarra_devdocroot/cfr/observations/xml/AB/today/today_ab_20180210_e.xml cannot stat.
      1 /home/peter/.cache/sarra/log/sr_cpump_xvan_f14_0001.log [ERROR] binding failed: server channel error 404h, message: NOT_FOUND - no exchange &#39;xcvan00&#39; in vhost &#39;/&#39;
      1 /home/peter/.cache/sarra/log/sr_cpump_xvan_f15_0001.log [ERROR] binding failed: server channel error 404h, message: NOT_FOUND - no exchange &#39;xcvan01&#39; in vhost &#39;/&#39;
      1 /home/peter/.cache/sarra/log/sr_sarra_download_f20_0002.log [ERROR] Download failed http://dd2.weather.gc.ca//bulletins/alphanumeric/20180210/CA/CWAO/09/CACN00_CWAO_100857__WDK_10905
      1 /home/peter/.cache/sarra/log/sr_sarra_download_f20_0002.log [ERROR] Failed to reach server. Reason: [Errno 110] Connection timed out
      1 /home/peter/.cache/sarra/log/sr_sarra_download_f20_0002.log [ERROR] Download failed http://dd2.weather.gc.ca//bulletins/alphanumeric/20180210/CA/CWAO/09/CACN00_CWAO_100857__WDK_10905. Type: &lt;class &#39;urllib.error.URLError&#39;&gt;, Value: &lt;urlopen error [Errno 110] Connection timed out&gt;
      1 /home/peter/.cache/sarra/log/sr_sarra_download_f20_0004.log [ERROR] Download failed http://dd2.weather.gc.ca//bulletins/alphanumeric/20180210/SA/CYMM/09/SACN61_CYMM_100900___53321
      1 /home/peter/.cache/sarra/log/sr_sarra_download_f20_0004.log [ERROR] Failed to reach server. Reason: [Errno 110] Connection timed out
      1 /home/peter/.cache/sarra/log/sr_sarra_download_f20_0004.log [ERROR] Download failed http://dd2.weather.gc.ca//bulletins/alphanumeric/20180210/SA/CYMM/09/SACN61_CYMM_100900___53321. Type: &lt;class &#39;urllib.error.URLError&#39;&gt;, Value: &lt;urlopen error [Errno 110] Connection timed out&gt;
      1 /home/peter/.cache/sarra/log/sr_sarra_download_f20_0004.log [ERROR] Download failed http://dd2.weather.gc.ca//bulletins/alphanumeric/20180210/CS/CWEG/12/CSCN03_CWEG_101200___12074
more than 10 TYPES OF ERRORS found... for the rest, have a look at /home/peter/src/sarracenia/test/flow_check_errors_logged.txt for details

test  1 success: shovels t_dd1_f00 (100008) and t_dd2_f00 (100008) should have about the same number of items read
test  2 success: sarra tsarra (100008) should be reading about half as many items as (both) winnows (200016)
test  3 success: tsarra (100008) and sub t_f30 (99953) should have about the same number of items
test  4 success: max shovel (100008) and subscriber t_f30 (99953) should have about the same number of items
test  5 success: count of truncated headers (100008) and subscribed messages (100008) should have about the same number of items
test  6 success: count of downloads by subscribe t_f30 (99953) and messages received (100008) should be about the same
test  7 success: same downloads by subscribe t_f30 (199906) and files posted (add+remove) by sr3_watch (199620) should be about the same
test  8 success: posted by watch(199620) and subscribed cp_f60 (99966) should be about half as many
test  9 success: posted by watch(199620) and sent by sr_sender (199549) should be about the same
test 10 success: 0 messages received that we don&#39;t know what happenned.
test 11 success: sarra tsarra (100008) and good audit 99754 should be the same.
test 12 success: poll test1_f62 94865 and subscribe q_f71 99935 run together. Should have equal results.
test 13 success: post test2_f61 99731 and subscribe r_ftp_f70 99939 run together. Should be about the same.
test 14 success: posts test2_f61 99731 and shim_f63 110795 Should be the same.
test 15 success: cpump both pelles (c shovel) should receive about the same number of messages (160737) (160735)
test 16 success: cdnld_f21 subscribe downloaded (50113) the same number of files that was published by both van_14 and van_15 (50221)
test 17 success: veille_f34 should post twice as many files (100205) as subscribe cdnld_f21 downloaded (50113)
test 18 success: veille_f34 should post twice as many files (100205) as subscribe cfile_f44 downloaded (49985)
test 19 success: Overall 18 of 18 passed (sample size: 100008) !

blacklab%
</pre></div>
</div>
<p>Ce test a été lancé en fin de journée, car il prend plusieurs heures, et les résultats examinés le lendemain matin.</p>
</section>
<section id="echantillon-a-volume-eleve">
<h3>Échantillon à volume élevé<a class="headerlink" href="#echantillon-a-volume-eleve" title="Link to this heading"></a></h3>
<p>Essayer le test de flux avec un volume plus élevé de messages de notification (c’est-à-dire 100 000)
est un pas de plus vers l’objectif d’avoir un test de flux exécuté en continu. Ceci est motivé par
nos objectifs de test.</p>
<section id="limitation">
<h4>Limitation<a class="headerlink" href="#limitation" title="Link to this heading"></a></h4>
<p>Ubuntu a une limitation qui surpasse les montres inotify et que nous avons rencontrée dans
<a class="reference external" href="https://github.com/MetPX/sarracenia/issues/204">#204</a> . Nous pouvons surmonter cela en définissant la variable sysctl associée.
Tout d’abord, vérifiez quelle est la limite de votre système:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sysctl fs.inotify.max_user_watches
fs.inotify.max_user_watches = 8196
</pre></div>
</div>
<p>Si la limite est trop basse (c.-à-d. 8196), changez-la à un niveau plus approprié pour l’essai de débit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo sysctl fs.inotify.max_user_watches=524288
</pre></div>
</div>
<p>Pour rendre cette modification permanente, ajoutez cette ligne à <code class="docutils literal notranslate"><span class="pre">/etc/sysctl.conf</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fs</span><span class="o">.</span><span class="n">inotify</span><span class="o">.</span><span class="n">max_user_watches</span><span class="o">=</span><span class="mi">524288</span>
</pre></div>
</div>
<p>Puis excuter <code class="docutils literal notranslate"><span class="pre">sysctl</span> <span class="pre">-p</span></code> Et le système devrait maintenant prendre en charge un volume élevé d’événements iNotify.</p>
</section>
<section id="flow-test-coince">
<h4>Flow Test Coincé<a class="headerlink" href="#flow-test-coince" title="Link to this heading"></a></h4>
<p>Parfois, les tests de flux (en particulier pour les grands nombres) sont bloqués en raison de problèmes avec
le flux de données (où plusieurs fichiers obtiennent le même nom) et donc les versions antérieures suppriment
les versions ultérieures et les nouvelles tentatives échouent toujours. Finalement, nous réussirons à nettoyer
le flux dd.weather.gc.ca, mais pour l’instant, il arrive parfois qu’un flow_check reste bloqué à “Retrying”.
Le test a exécuté tous les messages de notification requis et est à une phase de vidange des tentatives,
mais continue de réessayer pour toujours avec un nombre variable d’éléments qui ne tombe jamais à zéro.</p>
<p>Pour récupérer de cet état sans rejeter les résultats d’un test long, procédez comme suit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>^C to interrupt the flow_check.sh 100000
blacklab% sr3 stop
blacklab% cd ~/.cache/sarra
blacklab% ls */*/*retry*
shovel/pclean_f90/sr_shovel_pclean_f90_0001.retry        shovel/pclean_f92/sr_shovel_pclean_f92_0001.retry        subscribe/t_f30/sr_subscribe_t_f30_0002.retry.new
shovel/pclean_f91/sr_shovel_pclean_f91_0001.retry        shovel/pclean_f92/sr_shovel_pclean_f92_0001.retry.state
shovel/pclean_f91/sr_shovel_pclean_f91_0001.retry.state  subscribe/q_f71/sr_subscribe_q_f71_0004.retry.new
blacklab% rm */*/*retry*
blacklab% sr3 start
blacklab%
blacklab%  ./flow_check.sh 100000
Sufficient!
stopping shovels and waiting...
2018-04-07 10:50:16,167 [INFO] sr_shovel t_dd2_f00 0001 stopped
2018-04-07 10:50:16,177 [INFO] sr_shovel t_dd1_f00 0001 stopped
2018-04-07 14:50:16,235 [INFO] info: instances option not implemented, ignored.
2018-04-07 14:50:16,235 [INFO] info: report option not
implemented, ignored.
2018-04-07 14:50:16,235 [INFO] info: instances option not implemented, ignored.
2018-04-07 14:50:16,235 [INFO] info: report option not
implemented, ignored.
running instance for config pelle_dd1_f04 (pid 12435) stopped.
running instance for config pelle_dd2_f05 (pid 12428) stopped.
maximum of the shovels is: 100075


blacklab% ./flow_check.sh

                 | dd.weather routing |
test  1 success: sr_shovel (100075) t_dd1 should have the same number
of items as t_dd2 (100068)
test  2 success: sr_winnow (200143) should have the sum of the number
of items of shovels (200143)
test  3 success: sr_sarra (98075) should have the same number of items
as winnows&#39;post (100077)
test  4 success: sr_subscribe (98068) should have the same number of
items as sarra (98075)
                 | watch      routing |
test  5 success: sr3_watch (397354) should be 4 times subscribe t_f30 (98068)
test  6 success: sr_sender (392737) should have about the same number
of items as sr3_watch (397354)
test  7 success: sr_subscribe u_sftp_f60 (361172) should have the same
number of items as sr_sender (392737)
test  8 success: sr_subscribe cp_f61 (361172) should have the same
number of items as sr_sender (392737)
                 | poll       routing |
test  9 success: sr_poll test1_f62 (195408) should have half the same
number of items of sr_sender(196368)
test 10 success: sr_subscribe q_f71 (195406) should have about the
same number of items as sr_poll test1_f62(195408)
                 | flow_post  routing |
test 11 success: sr3_post test2_f61 (193541) should have half the same
number of items of sr_sender(196368)
test 12 success: sr_subscribe ftp_f70 (193541) should have about the
same number of items as sr3_post test2_f61(193541)
test 13 success: sr3_post test2_f61 (193541) should have about the same
number of items as shim_f63 195055
                 | py infos   routing |
test 14 success: sr_shovel pclean_f90 (97019) should have the same
number of watched items winnows&#39;post (100077)
test 15 success: sr_shovel pclean_f92 (94537}) should have the same
number of removed items winnows&#39;post (100077)
test 16 success: 0 messages received that we don&#39;t know what happenned.
test 17 success: count of truncated headers (98075) and subscribed
messages (98075) should have about the same number of items
                 | C          routing |
test 18 success: cpump both pelles (c shovel) should receive about the
same number of messages (161365) (161365)
test 19 success: cdnld_f21 subscribe downloaded (47950) the same
number of files that was published by both van_14 and van_15 (47950)
test 20 success: veille_f34 should post twice as many files (95846) as
subscribe cdnld_f21 downloaded (47950)
test 21 success: veille_f34 should post twice as many files (95846) as
subscribe cfile_f44 downloaded (47896)
test 22 success: Overall 21 of 21 passed (sample size: 100077) !

NB retries for sr_subscribe t_f30 0
NB retries for sr_sender 36
</pre></div>
</div>
<p>Donc, dans ce cas, les résultats sont toujours bons en dépit de ne pas être tout à fait
capable de résilier. S’il y avait un problème important, le cumul
l’indiquerait.</p>
</section>
</section>
<section id="flow-tests-avec-mqtt">
<h3>Flow tests avec MQTT<a class="headerlink" href="#flow-tests-avec-mqtt" title="Link to this heading"></a></h3>
<p>Les tests de flux peuvent être exécutés lorsque certains composants utilisent le protocole MQTT, au lieu d’AMQP.</p>
<p>FIXME: étapes manquantes, plus de clarté requise.</p>
<ul class="simple">
<li><p>Le courtier MQTT est installé</p></li>
<li><p>Les utilisateurs de BunnyMaster Tsource, Tfeed, Tsub sont définis et ont reçu des mots de passe (dépendants du courtier.)</p></li>
<li><p>Pour chaque utilisateur : une ligne d’URL mqtt://user:pw&#64;brokerhost est ajoutée à ~/.config/sr3/credentials.conf</p></li>
<li><p>modifier la variable MQP dans ~/.config/sr3/default.conf, MQP est utilisée par les tests de flux.</p></li>
</ul>
<p>La plupart des composants utiliseront MQTT au lieu d’amqp et peuvent être exécutés normalement.</p>
</section>
</section>
<section id="commits-vers-la-branche-principale">
<h2>Commits vers la branche principale<a class="headerlink" href="#commits-vers-la-branche-principale" title="Link to this heading"></a></h2>
<p>A part les fautes de frappe, les corrections de langue dans la documentation et l’incrémentation
de la version, les développeurs ne sont pas censés s’engager sur Main (branche principale). Tous les travaux
se produisent sur les branches de développement, et tous les tests doivent réussir avant
de considerer d’affecter Main. Une fois le développement de la branche terminé,
ou qu’une unité de travaux en cours est jugée utile de fusionner avec la branche principale, on
doit résumer les modifications de la branche pour le journal des modifications de Debian,
demande sur GitHub.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">checkout</span> <span class="n">issueXXX</span>  <span class="c1"># v02_issueXXX  pour du travaille sur l´ancienne version.</span>
<span class="n">dch</span> <span class="c1"># résumer les changement dans changelog.</span>
<span class="n">vi</span> <span class="n">doc</span><span class="o">/</span><span class="n">UPGRADING</span><span class="o">.</span><span class="n">rst</span> <span class="c1"># rarement en cas de changement visible dont l´usager doit prendre connaissance.</span>
<span class="n">vi</span> <span class="n">doc</span><span class="o">/</span><span class="n">fr</span><span class="o">/</span><span class="n">UPGRADING</span><span class="o">.</span><span class="n">rst</span> <span class="c1"># bon... ceci est visible aux usagers, donc...</span>
<span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">a</span>
<span class="n">git</span> <span class="n">push</span>
<span class="c1"># déclencher un *pull request* chez github.com</span>
</pre></div>
</div>
<p>Un deuxième développeur examinera la demande d’extraction et le réviseur décidera si
la fusion est appropriée. On s’attend à ce que le développeur examine chaque validation, et
la comprenne dans une certaine mesure.</p>
<p>Le github Actions examine les pull requests et effectue des tests de flux sur celles-ci.
Si les tests réussissent, alors c’est un bon indicateur qualitatif, mais les tests sont un peu
fragile pour le moment, donc s’ils échouent, il serait idéal que le réviseur exécute
les tests dans leur propre environnement de développement. S’il passe dans l’environnement du développeur local
on peut approuver une fusion malgré les plaintes de Github Actions.</p>
</section>
<section id="branches-principales">
<h2>Branches Principales<a class="headerlink" href="#branches-principales" title="Link to this heading"></a></h2>
<p>Il y a une longue discussion sur <a class="reference external" href="https://github.com/MetPX/sarracenia/issues/139">Quelle version est stable</a>
La configuration actuelle est qu’il y a quatre branches principales:</p>
<ul class="simple">
<li><p>La branche principale est la version finale de SR3, fusionnant à partir de development. Utilisé pour créer des
packages SR3 dans le référentiel <a class="reference external" href="https://launchpad.net/~ssc-hpc-chp-spc/+archive/ubuntu/metpx">MetPX</a>.</p></li>
<li><p>development … La <a class="reference internal" href="v03.html"><span class="doc">version 3</span></a> La branche de travail en cours (WIP) est une prochaine version de Sarracenia
en développement. La branche development est utilisée pour créer des packages sr3 pour le
<a class="reference external" href="https://launchpad.net/~ssc-hpc-chp-spc/+archive/ubuntu/metpx-daily">Quotidien</a>
et les référentiels <a class="reference external" href="https://launchpad.net/~ssc-hpc-chp-spc/+archive/ubuntu/metpx-pre-release">Pre-Release</a>
sur launchpad.net.</p></li>
<li><p>Les branches de issue à fusionner avec development, devraient s’appeler v3_issueXXX</p></li>
<li><p>v2_dev … La branche d’intégration pour la maintenance v2 utilisée avant la promotion à v2_stable.</p></li>
<li><p>v2_stable … Généralement, cette branche obtient du code via des fusions à partir de v2_dev, après
que la pré-version a été testée sur autant de systèmes que possible. Utilisé pour construire des
paquets sur la version stable: <a class="reference external" href="https://launchpad.net/~ssc-hpc-chp-spc/+archive/ubuntu/metpx">MetPX</a></p></li>
<li><p>les branches issues à fusionner avec stable doivent être appelées issueXXX.</p></li>
</ul>
</section>
<section id="depots-de-pacquets-ubuntu-launchpad-net">
<h2>Dépots de pacquets Ubuntu: Launchpad.net<a class="headerlink" href="#depots-de-pacquets-ubuntu-launchpad-net" title="Link to this heading"></a></h2>
<p>Pour les systèmes d’exploitation Ubuntu, le site launchpad.net est le meilleur moyen de fournir des packages
entièrement intégrés (construit par rapport aux niveaux de correctifs actuels de toutes les dépendances
(composants logiciels sur lesquels Sarracenia s’appuie) pour fournir toutes les fonctionnalités.)) Idéalement,
lors de l’exécution d’un serveur, on devrait utiliser l’un des référentiels, et permettre des correctifs
automatisés pour les mettre à niveau selon les besoins.</p>
<p>Référentiels:</p>
<ul class="simple">
<li><p>Quotidien <a class="reference external" href="https://launchpad.net/~ssc-hpc-chp-spc/+archive/ubuntu/metpx-daily">https://launchpad.net/~ssc-hpc-chp-spc/+archive/ubuntu/metpx-daily</a> (Vivre sur le fil du rasoir… )
La construction quotidienne automatisée des paquets SR3 se fait à partir de la branche <em>development</em>.</p></li>
<li><p>Pré-release <a class="reference external" href="https://launchpad.net/~ssc-hpc-chp-spc/+archive/ubuntu/metpx-pre-release">https://launchpad.net/~ssc-hpc-chp-spc/+archive/ubuntu/metpx-pre-release</a> (pour les fonctionnalités
les plus récentes.) De la branche <em>development</em>. Les développeurs déclenchent manuellement les builds ici lorsque
cela semble approprié (tester du code prêt à être publié.)</p></li>
<li><p>Release <a class="reference external" href="https://launchpad.net/~ssc-hpc-chp-spc/+archive/ubuntu/metpx">https://launchpad.net/~ssc-hpc-chp-spc/+archive/ubuntu/metpx</a> (pour une stabilité maximale)
de la branche <em>v2_stable</em>.  Après avoir testé dans des systèmes souscrits à des versions préliminaires,
les développeurs fusionnent la branche v2_dev à v2_stable et déclenchent manuellement une génération.</p></li>
</ul>
<p>Pour plus de détails, voir <a class="reference external" href="https://github.com/MetPX/sarracenia/issues/139">Quelle version est stable</a></p>
<section id="local-python">
<h3>Local Python<a class="headerlink" href="#local-python" title="Link to this heading"></a></h3>
<p>Utilisation d’une version non packagée :</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>python3 setup.py build
python3 setup.py install</p>
</div>
</section>
<section id="windows">
<h3>Windows<a class="headerlink" href="#windows" title="Link to this heading"></a></h3>
<p>Installez winpython à partir de github.io version 3.4 ou supérieure.
Utilisez ensuite pip pour installer à partir de PyPI.</p>
</section>
</section>
<section id="conventions">
<h2>Conventions<a class="headerlink" href="#conventions" title="Link to this heading"></a></h2>
<p>Vous trouverez ci-dessous quelques pratiques de codage destinées à guider les développeurs lorsqu’il
contribuent à Sarracenia. Ce ne sont pas des règles strictes, juste des conseils.</p>
<section id="quand-signaler">
<h3>Quand signaler<a class="headerlink" href="#quand-signaler" title="Link to this heading"></a></h3>
<p>sr_report(7) Les messages de notification doivent être émis pour indiquer la disposition finale des
données elles-mêmes, et non des notifications ou des messages de rapport (ne signalez pas les messages
de rapport, cela devient une boucle infinie!) Pour le débogage et d’autres informations, le fichier
journal local est utilisé.  Par exemple, sr_shovel n’émet aucun message sr_report(7), car aucune
donnée n’est transférée, seulement des messages.</p>
</section>
</section>
<section id="ajout-d-un-dependence">
<h2>Àjout d´un Dépendence<a class="headerlink" href="#ajout-d-un-dependence" title="Link to this heading"></a></h2>
<p>La gestion des dépendances est un sujet compliqué, car python a de nombreuses méthodes d’installation
différentes dans des environnements disparates, et Sarracenia est multi-plateforme. La pratique standard
de python pour les dépendances consiste à faire les <em>nécessaires</em> en les listant dans requirements.txt
ou setup.py, et demandez à tous les utilisateurs de les installer.  Dans la plupart des applications
python, si une dépendance est manquante, elle se bloque simplement avec un message d’échec d’importation
de quelques sortes.</p>
<p>Dans Sr3, nous avons constaté qu’il existe de nombreux environnements différents déployés dans lesquels
les dépendances peuvent être plus gênantes qu’elles n’en valent la peine, donc chacune des dépendances
dans setup.py est également traité dans sarracenia/featuredetection, et le code de détection de
fonctionnalité permet à l’application de continuer à travailler, juste sans la fonctionnalité fournie
par le module manquant. C’est ce qu’on appelle la <em>dégradation</em> ou <em>mode dégradé</em>. L’idée étant
d’aider l’utilisateur à faire le maximum, dans l’environnement dont il dispose, tout en leur disant
ce qui manque, et ce qu’il faudrait idéalement ajouter.</p>
<p>pleine discussion (en anglais seulement):</p>
<p><a class="reference external" href="https://github.com/MetPX/sarracenia/issues/741">Managing Dependencies (Discussion)</a></p>
<p>version courte:</p>
<p>En plus de requirements.dev/setup.py, si vous devez ajouter une nouvelle bibliothèque qui ne fait pas partie de
<em>piles incluses</em>, généralement fournies par un package os ou pip séparé, alors vous voulez
prévoir que sr3 fonctionne toujours dans le cas où le package n’est pas disponible (bien que
sans la fonction que vous ajoutez) et pour ajouter un support pour expliquer ce qui manque en utilisant
le module sarracenia/featuredetection.py.</p>
<p>Dans ce module se trouve une structure de données <em>features</em>, où vous ajoutez une entrée expliquant
l’importation nécessaire et les fonctionnalités qu’il apporte à Sr3. Vous ajoutez également les
protections if feature[‘x’][‘present’] dans le code où vous utilisez la fonctionnalité, afin de
permettre au code de se dégrader avec élégance.</p>
<p>Si la dépendance est ajoutée dans un plugin, alors il y a aussi une méthode pour celle décrite ici :</p>
<p><a href="#id4"><span class="problematic" id="id5">`Guide de Programmeur&lt;../Explication/SarraPluginDev.html#ajout-de-dépendance-python-dans-les-callbacks&gt;`_</span></a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Contribuer à Sarracenia" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Documentation.html" class="btn btn-neutral float-right" title="Normes de documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Shared Services Canada, Government of Canada, GPLv2.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>