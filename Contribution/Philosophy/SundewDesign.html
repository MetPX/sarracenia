<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sundew Algorithmic Design &mdash; Sarracenia 3.00.55rc2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
    <link rel="shortcut icon" href="../../_static/sarra_horror_culture_favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=bcc5ee3f"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Sarracenia
              <img src="../../_static/sarra_horror_culture_w200.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.00.55rc2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Explanation/Overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../How2Guides/index.html">HOWTOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Explanation/index.html">Explanation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-documentation.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fr/index.html">En français</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Sarracenia</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Sundew Algorithmic Design</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Contribution/Philosophy/SundewDesign.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Sundew-Algorithmic-Design">
<h1>Sundew Algorithmic Design<a class="headerlink" href="#Sundew-Algorithmic-Design" title="Link to this heading"></a></h1>
<p>Sundew was built because PDS was too slow for message routing, which typically had:</p>
<ul class="simple">
<li><p>hundreds of thousands of different products to route (order of 300,000 products in the routing table.)</p></li>
<li><p>several dozen destinations.</p></li>
<li><p>need to route 20 messages per second during the day, but during an outage, need to recover the failure quickly (say 100 messages per second, so a one hour outage would be recovered in 12 minutes or so.)</p></li>
<li><p>we were seeing peak routing speed in the teens to low 20’s. It could keep up with routine traffic, but would often fall behind during traffic spurts, and took a very long time to recover after outages.</p></li>
</ul>
<p>Sundew, a replacement implementation of PDS, was eventually made to solve this problem. It made the following alrogithimic design changes:</p>
<section id="Eliminate-Dispatcher">
<h2>Eliminate Dispatcher<a class="headerlink" href="#Eliminate-Dispatcher" title="Link to this heading"></a></h2>
<p>Having a single process doing the routing limits scaling. Instead, have each receiver identify the outputs for files it receives. This means operating multiple routing engines in parallel, which gives the potential for name clashes in the destination directories (if two receivers choose to same names for different data)</p>
<ul class="simple">
<li><p>Make sure all file names chosen for routing are unique.</p></li>
</ul>
<p>On systems with more cores available, having more processes able to route is a benefit. Comparing regular expressions is a cpu-bound problem. With 10 receivers, one can expect a 10-fold improvement in routing performance… eg. the routing performance of the server should scale with the number of products being received.</p>
<p>It should also be noted that while scanning directories is an i/o bound process with lots of waiting, routing is a completely cpu bound process, so combining the two doesn’t worsen the overall load of the receivers substantially.</p>
</section>
<section id="Eliminate-Log-Locking">
<h2>Eliminate Log Locking<a class="headerlink" href="#Eliminate-Log-Locking" title="Link to this heading"></a></h2>
<p>Contention for writing the combined log of all processes is performance limiting, and wastes a great deal of cpu on locks to serialize access. if each process writes its own log, there is no contention for the log file. Dropping the constraint of a single log file unlocks a great deal of performance potential.</p>
<p>From an architectural perspective, this is just a pure win, there was a hard limit on absolute performance, and it is completely eliminated.</p>
</section>
<section id="Dictionary-Pre-Routing">
<h2>Dictionary Pre-Routing<a class="headerlink" href="#Dictionary-Pre-Routing" title="Link to this heading"></a></h2>
<p>Even if we parallelize routing, the algorithm itself is quite intensive. for 10 destinations, with 10 regular expressions each, that means 100 regular expressions to evaluate (slightly less, because of shortcuts from exclusion masks (rejects) but the order of magnitude is about right.)</p>
<p>Added the use of a python dictionary listing product keys, and a set of destinations associated with each key. So there are now two steps to routing, the first narrows down the number of destinations to a subset… say 2/10 of destinations, and then the regular expressions are only applied on that subset.</p>
<p>The cost to route a single product through the application (take it from seeing it in a reception directory to queuing it up for sending.) can be modelled as follows: It is the regular expression comparisong that dominate the routing time, so just calculate how many regular expressions are needed, on average, to complete routing of a product.</p>
<ul class="simple">
<li><p>Sundew Routing cost: log(d) * s * (re/2) … log(300000)* 10 * (10/2) = 18<em>10</em>5 = 900</p>
<ul>
<li><p>each receiver only routing for a single receiver.</p></li>
<li><p>d = 300000, the size of the product dictionary (around 300000)</p></li>
<li><p>re = 10, the dictionary allows us to reduce the number of regex’s used for product</p></li>
<li><p>s is the subset of destinations chosen for a typical key (10)</p></li>
<li><p>dictionary lookup time is a log of the number of different product keys to assign.</p></li>
</ul>
</li>
</ul>
<p>It is important to note that S grew substantially once Sundew was in place, we peaked at about 500 senders… with PDS, that would have meant 25000 regex comparisons per product routed, while Sundew routing algorithmic cost is independent of the number of senders extant.</p>
<p>Note that a single process does all routing in PDS, where each receiver (initial configurations had R=10) distributed routing duties to each receiver, giving 10x available algorithmic speedup, as routing is embarassingly parallel (completely perallelizable.)</p>
<p><strong>NOTE:</strong> this algorithm only benefits “message” type routing with the dictionary. for file type routing, used in PDS traditionally, we fall back on pure regexes.</p>
</section>
<section id="Write-it-in-Python">
<h2>Write it in Python<a class="headerlink" href="#Write-it-in-Python" title="Link to this heading"></a></h2>
<p>Sundew was built in Python. Industry lore is that Python is much slower than C, the measurable amounts vary, but as a rule of thumb, one can attribute approximately an order of magnitude there as well. It was judged safe to use Python in this case because the application is entirely i/o bound, and thus the speed of C was not material to the problem at hand. When using python, code is much simpler to write, and much shorter. the PDS application was approximately 150,000 lines of C clode. The
Python application is 25,0000 lines.</p>
<p>Sundew also replaced another message router, called “Tandem Apps”, which was 450,000 lines of code in proprietary language. replacing 600,000 lines of code is a major project, writing 25,000 lines is a biggish script. So a 96% reduction in the source code size. This choice:</p>
<ul class="simple">
<li><p>made the project feasible.</p></li>
<li><p>made the algorithms in use far simpler to understand and implement.</p></li>
</ul>
</section>
<section id="id1">
<h2>Eliminate Dispatcher<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>replace single task routing for all receivers</p></li>
<li><p>every receiver queues products for senders.</p></li>
<li><p>routing performance expands as a function of the number of receivers.</p></li>
</ul>
</section>
<section id="id2">
<h2>Dictionary Pre-Routing<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>map bulletin names to a key, list the keys in a table (aka python dictionary) that lists senders.</p></li>
<li><p>selects a subset of senders to which their regex’s are applied.</p></li>
</ul>
</section>
<section id="Sundew-Routing-cost:">
<h2>Sundew Routing cost:<a class="headerlink" href="#Sundew-Routing-cost:" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Rp = 900 = log(d) * s * (re/2)</p></li>
<li><p>r = 10, each receiver only routing for a single receiver.</p></li>
<li><p>d = 300000, the size of the product dictionary (around 300000)</p></li>
<li><p>n = the length of each key.</p></li>
<li><p>re = 10, the dictionary allows us to reduce the number of regex’s used for product</p></li>
<li><p>s is the subset of destinations chosen for a typical key (10)</p></li>
<li><p>dictionary lookup time is a log of the number of different product keys to assign.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[102]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span>

<span class="n">r</span><span class="o">=</span><span class="mi">10</span> <span class="c1"># number of receivers, each receiver is routing for itself alone. naturally de-composing the routing problem.</span>
<span class="n">d</span><span class="o">=</span><span class="mi">300000</span> <span class="c1"># number of products in the routing table, pre-existing table used by previous system.</span>
<span class="n">re</span><span class="o">=</span><span class="mi">10</span> <span class="c1"># number of regexes in each sender, given that pre-routing with the dictionary has occurred.</span>
<span class="n">s</span><span class="o">=</span><span class="mi">10</span> <span class="c1"># number of destinations selected by Pre-Routing.</span>
<span class="n">n</span><span class="o">=</span><span class="mi">10</span> <span class="c1"># the number of characters in each key.</span>

<span class="c1"># cost to look up each string to find a corresponding integer is in the log(d)</span>
<span class="n">Lum</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># map key string to a token number.</span>
<span class="n">Luk</span><span class="o">=</span><span class="n">log</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># lookup the token in the dictionary.</span>

<span class="c1"># cost to search a dictionary to find a match. (integer ops...)</span>
<span class="n">Rpr</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#convert integer ops, to RE ...</span>
<span class="n">RE</span><span class="o">=</span><span class="mi">100</span>

<span class="c1">#Client side routing cost:</span>

<span class="n">Rpc</span><span class="o">=</span><span class="n">s</span><span class="o">*</span><span class="n">RE</span><span class="o">*</span><span class="n">re</span><span class="o">/</span><span class="mi">2</span>

<span class="n">RP</span><span class="o">=</span><span class="n">Rpr</span><span class="o">+</span><span class="n">Rpc</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;total routing cost, pre product, done by each receiver: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">Rp</span><span class="p">)</span><span class="si">}</span><span class="s2"> instructions&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;in terms of load distribution, the pre-routing falls on the receivers: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">Rpr</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;and the rest </span><span class="si">{</span><span class="n">Rpc</span><span class="si">}</span><span class="s2"> falls on the senders&quot;</span> <span class="p">)</span>

<span class="c1"># for files, instead of messages.</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
total routing cost, pre product, done by each receiver: 181946 instructions
in terms of load distribution, the pre-routing falls on the receivers: 36
and the rest 5000.0 falls on the senders
</pre></div></div>
</div>
</section>
<section id="id3">
<h2>Write it in Python<a class="headerlink" href="#id3" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>made the project feasible (10x smaller)</p></li>
<li><p>made the algorithm simpler to understand an implement.</p></li>
<li><p>problem i/o bound, python performance not an issue.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[98]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Arrow</span><span class="p">,</span> <span class="n">FancyArrow</span>

<span class="k">def</span> <span class="nf">directory_polygon</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">,</span><span class="n">arrow1</span><span class="p">):</span>
   <span class="k">return</span> <span class="p">[</span> <span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
               <span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.2</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
               <span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.4</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
            <span class="n">FancyArrow</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">1.4</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                       <span class="n">head_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span><span class="p">),</span>
            <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.6</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">)</span>
          <span class="p">]</span>


<span class="k">def</span> <span class="nf">create_base</span><span class="p">(</span><span class="n">box_bg</span> <span class="o">=</span> <span class="s1">&#39;#CCCCCC&#39;</span><span class="p">,</span>
                <span class="n">arrow1</span> <span class="o">=</span> <span class="s1">&#39;#88CCFF&#39;</span><span class="p">,</span>
                <span class="n">arrow2</span> <span class="o">=</span> <span class="s1">&#39;#88FF88&#39;</span><span class="p">,</span>
                <span class="n">supervised</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                 <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

    <span class="n">x</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">y</span><span class="o">=</span><span class="mf">3.6</span>
    <span class="n">patches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">directory_polygon</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">,</span><span class="n">arrow1</span><span class="p">))</span>
    <span class="n">y</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">directory_polygon</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">,</span><span class="n">arrow1</span><span class="p">))</span>
    <span class="n">y</span><span class="o">=</span><span class="mf">1.8</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">directory_polygon</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">,</span><span class="n">arrow1</span><span class="p">))</span>

    <span class="nb">len</span><span class="o">=</span><span class="mf">1.8</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.1</span><span class="p">,</span> <span class="mf">4.3</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.1</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>

          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.1</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.1</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>

          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.1</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>

          <span class="n">Circle</span><span class="p">((</span><span class="mf">5.8</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
          <span class="n">Circle</span><span class="p">((</span><span class="mf">5.8</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
          <span class="n">Circle</span><span class="p">((</span><span class="mf">5.8</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">)</span>
        <span class="p">])</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patches</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.2</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span> <span class="s1">&#39;Receiver&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.2</span><span class="p">,</span><span class="mf">2.35</span><span class="p">,</span> <span class="s1">&#39;Receiver&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.2</span><span class="p">,</span><span class="mf">4.15</span><span class="p">,</span> <span class="s1">&#39;Receiver&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span><span class="mf">1.05</span><span class="p">,</span> <span class="s1">&#39;Sender&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span><span class="mf">2.35</span><span class="p">,</span> <span class="s1">&#39;Sender&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span><span class="mf">3.85</span><span class="p">,</span> <span class="s1">&#39;Sender&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">create_base</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Sundew Component Design&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/Contribution_Philosophy_SundewDesign_7_0.png" src="../../_images/Contribution_Philosophy_SundewDesign_7_0.png" />
</div>
</div>
</section>
<section id="What-difference-did-it-make?">
<h2>What difference did it make?<a class="headerlink" href="#What-difference-did-it-make?" title="Link to this heading"></a></h2>
<p>On a given linux server used to run both applications for benchmarking purposes:</p>
<ul class="simple">
<li><p>The original (PDS) C-code was performing 10-20 product routings per second,</p></li>
<li><p>Sundew (the python replacement) was peaking at 150 messages per second with files,</p></li>
<li><p>Sundew was file system bound, and was also a message router, capable of routing over 400 messages/second.</p></li>
</ul>
<p>It feels safe to say it was approximately an order of magnitude improvement in performance.</p>
<p>Note:: These tests were done in 2005, using, for example, hard disks for storage. Performance on current hardware is far superior.</p>
</section>
<section id="Bonus">
<h2>Bonus<a class="headerlink" href="#Bonus" title="Link to this heading"></a></h2>
<p>The original PDS application was surrounded by scripts and code to do many kinds of name processing, and with the original built in C, this was done with shell scripts. As a happy side-effect of implementing in Python, it became feasible to implement a plugin architecture to customize processing in a much more efficient way.</p>
<p>Instead of forking of processes, as required by additional functionality in PDS, we could define routines that would be called from the python code. These routines could be written in Python, and thus save enormous amounts of overhead from the fork/reap pattern.</p>
<p>While plugin architectures can be implemented in C, they are much more daunting, and having operations people writing C is a high bar to customize processing.</p>
<p>So a great deal of peripheral, or customized processing was accellerated by the use of Python as the implementation language.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Shared Services Canada, Government of Canada, GPLv2.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>