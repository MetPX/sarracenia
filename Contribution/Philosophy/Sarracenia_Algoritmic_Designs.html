

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sarracenia Algorithmic Design &mdash; Sarracenia 3.00.56rc2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
    <link rel="shortcut icon" href="../../_static/sarra_horror_culture_favicon.png"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8b8faa11"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Sarracenia
              <img src="../../_static/sarra_horror_culture_w200.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Explanation/Overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../How2Guides/index.html">HOWTOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Explanation/index.html">Explanation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-documentation.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fr/index.html">En français</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Sarracenia</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Sarracenia Algorithmic Design</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Contribution/Philosophy/Sarracenia_Algoritmic_Designs.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Sarracenia-Algorithmic-Design">
<h1>Sarracenia Algorithmic Design<a class="headerlink" href="#Sarracenia-Algorithmic-Design" title="Link to this heading"></a></h1>
<p>What were the issues with Sundew that led to Sarracenia?</p>
<ul class="simple">
<li><p>Problems/Weaknesses of Sundew</p></li>
<li><p>Key Decisions for Sarracenia</p>
<ul>
<li><p>Use Folders/Directories</p></li>
<li><p>Add a robust message queueing system.</p></li>
</ul>
</li>
</ul>
<section id="Problems/Weaknesses-of-Sundew:">
<h2>Problems/Weaknesses of Sundew:<a class="headerlink" href="#Problems/Weaknesses-of-Sundew:" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>push only, required someone else to send to us for us to receive. Senders always must configure who they are sending to.</p></li>
<li><p>limited parallelism: each receiver or sender is a single process, only a single sender for a single destination.</p></li>
<li><p>without dictionaries, the routing algorithm falls back on relatively expensive PDS routing. Message routing (the cheap kind) was disappearing.</p></li>
<li><p>internal design details, make the path names highly constrained (had to have colons in them, no folders, etc…) Nobody without very specific directory structures could use it.</p></li>
</ul>
</section>
<section id="Use-Folders/Directories">
<h2>Use Folders/Directories<a class="headerlink" href="#Use-Folders/Directories" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Sundew used only the name of the file to make routing decisions.</p></li>
<li><p>Sarracenia uses the entire path.</p>
<ul>
<li><p>It allows for any directory tree to be transferred, and for the</p></li>
<li><p>all the directories in the tree to contribute to routing decisions.</p></li>
<li><p>The entire path becomes file metadata.</p></li>
<li><p>more compatible/adoptable for different file flows.</p></li>
</ul>
</li>
</ul>
</section>
<section id="Add-RabbitMQ">
<h2>Add RabbitMQ<a class="headerlink" href="#Add-RabbitMQ" title="Link to this heading"></a></h2>
<p>Introduced rabbitmq/amqp broker. After years of study of performance (it was used as a pure dissemination tool, outside of Sundew for six years prior to start of work on Sarracenia, which made a message broker central to data routine.) We needed to ensured that, as a componentm it would scale reasonably well for our loads.</p>
<p>Using RabbitMQ, we introduced topic/based routing, as an analog to dictionary routing, but much more applicable to non-message traffic (aka files.) should improve routing decisions for files, while not hurting routing for messages too much. Product mix is much more file oriented than message oriented in recent times.</p>
<ul class="simple">
<li><p>topics provide a pre-filtering function that substantially reduces the amount of routing work done in the application. each sender now only has to check its own regexes.</p></li>
<li><p>the topic matching is done by the broker, and the broker has it’s own parallelization methods.</p></li>
<li><p>by sharing of queues, can parallelize all transfers (except initial one), both reception and transmission.</p></li>
<li><p>can obtain new products by subscribing to other data pumps. One is not restricted to only receiving data sent by others.</p></li>
</ul>
<p>Introduced an architectural constraint or weakness in the form of a message broker. Introducing such components is a rare, exceptional event.</p>
<ul class="simple">
<li><p>Use of message brokers do not introduce synchronization to an app. (messages are not locks.) they are queues so every process operates at it’s own speed.</p></li>
<li><p>It needs to be well done. RabbitMQ is well done. message brokers are hard.</p></li>
<li><p>scaling of rabbitmq is, in principle, possible, we have done so in some deployments.</p></li>
</ul>
</section>
<section id="id1">
<h2>Add RabbitMQ<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>topic based pre-routing.</p></li>
<li><p>robust, high performance implementation with good internal design for multi-core.</p></li>
<li><p>able to scale beyond one node.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a fig here...</span>
<span class="c1"># should have multiple readers for queue...</span>
<span class="c1"># might show multiple subscribers for reading from different pumps.</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Arrow</span><span class="p">,</span> <span class="n">FancyArrow</span>

<span class="k">def</span> <span class="nf">triple_circle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
       <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.9</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.7</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.5</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">)</span>
    <span class="p">]</span>

<span class="k">def</span> <span class="nf">directory_polygon</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">,</span><span class="n">arrow1</span><span class="p">):</span>
   <span class="k">return</span> <span class="p">[</span>
       <span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.2</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.4</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">FancyArrow</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">1.4</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
       <span class="p">]</span>


<span class="k">def</span> <span class="nf">create_base</span><span class="p">(</span><span class="n">box_bg</span> <span class="o">=</span> <span class="s1">&#39;#CCCCCC&#39;</span><span class="p">,</span>
                <span class="n">arrow1</span> <span class="o">=</span> <span class="s1">&#39;#88CCFF&#39;</span><span class="p">,</span>
                <span class="n">arrow2</span> <span class="o">=</span> <span class="s1">&#39;#88FF88&#39;</span><span class="p">,</span>
                <span class="n">supervised</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                 <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

    <span class="n">x</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">y</span><span class="o">=</span><span class="mf">3.6</span>
    <span class="n">patches</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">#patches.extend(directory_polygon(x,y,box_bg,arrow1))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">2.4</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">))</span>
    <span class="n">y</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="c1">#patches.extend(directory_polygon(x,y,box_bg,arrow1))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">2.4</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">))</span>
    <span class="n">y</span><span class="o">=</span><span class="mf">1.8</span>
    <span class="c1">#patches.extend(directory_polygon(x,y,box_bg,arrow1))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">2.4</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="n">box_bg</span><span class="p">))</span>
    <span class="nb">len</span><span class="o">=</span><span class="mf">0.5</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="nb">len</span><span class="o">+</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.25</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>

          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">5.25</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">5.25</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">5.2</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="nb">len</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">)</span>

        <span class="p">])</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="n">box_bg</span><span class="p">))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="n">box_bg</span><span class="p">))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">box_bg</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patches</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">4.25</span><span class="p">,</span><span class="mf">2.45</span><span class="p">,</span> <span class="s1">&#39;Message&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">4.25</span><span class="p">,</span><span class="mf">2.25</span><span class="p">,</span> <span class="s1">&#39;Broker&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.2</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span> <span class="s1">&#39;Subscriber&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.2</span><span class="p">,</span><span class="mf">2.35</span><span class="p">,</span> <span class="s1">&#39;Subscriber&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.2</span><span class="p">,</span><span class="mf">4.15</span><span class="p">,</span> <span class="s1">&#39;Subscriber&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">1.05</span><span class="p">,</span> <span class="s1">&#39;Sender&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">2.35</span><span class="p">,</span> <span class="s1">&#39;Sender&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">4.1</span><span class="p">,</span> <span class="s1">&#39;Sender&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">create_base</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">,</span> <span class="s1">&#39;Sarracenia Component Design&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/Contribution_Philosophy_Sarracenia_Algoritmic_Designs_5_0.png" src="../../_images/Contribution_Philosophy_Sarracenia_Algoritmic_Designs_5_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">Estimating the cost to route 1 product, using topic based routing along with the traditional regular expressions.</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span>

<span class="n">K</span><span class="o">=</span><span class="mi">10000</span>   <span class="c1"># number of topics/folders in the hierarchy</span>
<span class="n">B</span><span class="o">=</span><span class="mi">8</span>       <span class="c1"># branching level at each level in the hierarchy</span>
<span class="n">n</span><span class="o">=</span><span class="mi">10</span>      <span class="c1"># number of characters in a topic name</span>
<span class="n">b</span><span class="o">=</span><span class="mi">2</span>       <span class="c1"># number of bindings per sender</span>
<span class="n">S</span><span class="o">=</span><span class="mi">100</span>     <span class="c1"># number of senders</span>


<span class="c1"># routing cost on the broker, in integer ops.</span>
<span class="c1"># log(K,2)*n - lookup each topic in a dictionary to map it to an integer</span>
<span class="c1"># log(K,B)   - the depth of the higherarchy is a function of the total, and the number of choices at each level.</span>
<span class="c1"># log(B,2)   - the time to search each level in the hierarchy, comparing integers.</span>
<span class="c1">#</span>
<span class="n">Rpb</span> <span class="o">=</span> <span class="p">(</span> <span class="n">log</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="n">B</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="n">log</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">S</span> <span class="p">)</span>

<span class="c1"># AMQP exchanges function as an additional topic in the higherarchy at the top of the tree.</span>
<span class="c1"># so they can be ignored.</span>

<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot; the cost on the broker to route a single product: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">Rpb</span><span class="p">)</span><span class="si">}</span><span class="s2"> in integer ops&quot;</span>  <span class="p">)</span>

<span class="c1"># this is pretty iffy, used this conversion throughout, but if RE&#39;s are much cheaper, then</span>
<span class="c1"># ... the numbers change alot.</span>
<span class="c1"># convert integer ops to regular expressions.  This is difficult to estimate</span>
<span class="c1"># https://swtch.com/~rsc/regexp/regexp1.html &quot;Regular Expression Matching Can Be Simple And Fast (but is slow in Java, Perl, PHP, Python, Ruby, ...)&quot; -- Russ Cox, rsc@swtch.com</span>
<span class="c1"># it lists O(m,l)</span>
<span class="c1">#</span>
<span class="n">m</span><span class="o">=</span><span class="mi">30</span> <span class="c1"># the length of the regex being matched to.</span>
<span class="n">l</span><span class="o">=</span><span class="mi">50</span> <span class="c1"># the length of the string being matched.</span>
<span class="n">RE</span><span class="o">=</span><span class="n">l</span><span class="o">*</span><span class="n">m</span>

<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">regex&#39;s are O(m,l) = </span><span class="si">{</span><span class="n">RE</span><span class="si">}</span><span class="s2"> hmm... sounds like too much.&quot;</span><span class="p">)</span>
<span class="c1"># Seems overly pessimistic, overriding.</span>

<span class="n">RE</span><span class="o">=</span><span class="mi">100</span>

<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;overriding source, lowering estimate to </span><span class="si">{</span><span class="n">RE</span><span class="si">}</span><span class="s2"> more investigation needed.&quot;</span><span class="p">)</span>

<span class="c1"># on the client side, in # of regex evals.</span>

<span class="n">s</span><span class="o">=</span><span class="mi">10</span>   <span class="c1">#number of senders pre-routed to by the broker.</span>
<span class="n">re</span><span class="o">=</span><span class="mi">10</span>  <span class="c1">#number of regular expressions per sender to evaluate.</span>

<span class="n">Rpc</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">RE</span><span class="o">*</span><span class="n">re</span><span class="o">/</span><span class="mi">2</span>

<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;Assuming </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2"> senders selected by broker, each one needs to look at the </span><span class="si">{</span><span class="n">re</span><span class="si">}</span><span class="s2">&#39;s in it&#39;s configuration&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;Client-side routing cost is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">Rpc</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">Rp</span><span class="o">=</span><span class="n">Rpb</span><span class="o">+</span><span class="n">Rpc</span>

<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">t total cost=</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">Rp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<br/><br/><br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 the cost on the broker to route a single product: 120366 in integer ops

regex&#39;s are O(m,l) = 1500 hmm... sounds like too much.
overriding source, lowering estimate to 100 more investigation needed.
Assuming 10 senders selected by broker, each one needs to look at the 10&#39;s in it&#39;s configuration
Client-side routing cost is 5000

t total cost=125366
</pre></div></div>
</div>
</section>
<section id="The-Algorithmic-Cost-to-Route-1-File">
<h2>The Algorithmic Cost to Route 1 File<a class="headerlink" href="#The-Algorithmic-Cost-to-Route-1-File" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Application</p></th>
<th class="head"><p>Pr</p></th>
<th class="head"><p>Client</p></th>
<th class="head"><p>Dominant Term/ compute cost scales as a function of</p></th>
<th class="head"><p>Pre-Routing Done By</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PDS</p></td>
<td><p>500</p></td>
<td><p>50</p></td>
<td><p>product of the number of receivers, senders, products</p></td>
<td><p>One Dispatcher process</p></td>
</tr>
<tr class="row-odd"><td><p>Sundew File</p></td>
<td><p>500</p></td>
<td><p>50</p></td>
<td><p>product of the number of senders, products</p></td>
<td><p>All (10ish) receivers</p></td>
</tr>
<tr class="row-even"><td><p>Sundew Msg</p></td>
<td><p>&lt;1</p></td>
<td><p>5</p></td>
<td><p>log of the number of messages</p></td>
<td><p>All (10ish) receivers</p></td>
</tr>
<tr class="row-odd"><td><p>Sarracenia</p></td>
<td><p>120</p></td>
<td><p>5</p></td>
<td><p>log of the number of topics/folders</p></td>
<td><p>Message broker</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Units: Kilo Instructions per second. 500 = 0.5 MIPS.</p></li>
<li><p>broker is a service, but is multiprocessing/scaled itself. not a single process.</p></li>
<li><p>sender processes do the client-side routing in all cases.</p></li>
<li><p>For Sundew, this number is optimistic (bulletin) case, file case is more like PDS, but multiple routers.</p></li>
<li><p>for Sarracenia, this number applies to all routing.</p></li>
<li><p>give scaling factors the large the configuration, the bigger the perf. advantage for topc routing.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="n">s</span><span class="o">=</span><span class="mi">10</span> <span class="c1"># number of senders / product shipped.</span>
<span class="n">ServerPeak</span><span class="o">=</span><span class="mi">1000</span>

<span class="c1">#for PDS</span>
<span class="n">clientSide</span><span class="o">=</span><span class="mi">1000</span><span class="o">/</span><span class="mf">0.050</span> <span class="o">=</span> <span class="mi">20000</span>
<span class="n">Dispatcher</span><span class="o">=</span><span class="mi">1000</span><span class="o">/</span><span class="mf">0.5</span><span class="o">=</span> <span class="mi">2000</span>
<span class="n">PDSPeak</span><span class="o">=</span><span class="mi">2000</span>
<span class="c1"># limited to slowest element, which is the dispatcher, so 2000 is upper bound.</span>

<span class="c1">#For Sundew</span>
<span class="n">SundewClientSide</span><span class="o">=</span><span class="mi">1000</span><span class="o">/</span><span class="mf">0.005</span><span class="o">=</span> <span class="mi">200000</span>
<span class="n">SundewReceivers</span><span class="o">=</span><span class="mi">1000</span><span class="o">/</span><span class="mf">0.182</span> <span class="o">=</span> <span class="mi">5494</span>
<span class="n">SundewPeak</span><span class="o">=</span><span class="n">SundewReceivers</span><span class="o">*</span><span class="n">s</span><span class="o">=</span><span class="mi">54940</span>
<span class="c1"># limited minimum of client and receivers, so 54.9 is it.</span>

<span class="c1">#For Sarra</span>
<span class="n">SarraClientSide</span><span class="o">=</span><span class="mi">1000</span><span class="o">/</span><span class="mf">0.005</span> <span class="o">=</span> <span class="mi">200000</span>
<span class="n">SarraBroker</span><span class="o">=</span> <span class="mi">1000</span><span class="o">/</span><span class="mf">0.125</span> <span class="o">=</span> <span class="mf">8000.0</span>
<span class="c1"># how many cpus can a broker use to route? um... it isn&#39;t limited.. or is at least unknown...</span>
<span class="c1"># hmm... defined by the broker implementation.lets just use s.</span>
<span class="n">SarraPeak</span><span class="o">=</span> <span class="n">SarraBroker</span><span class="o">*</span><span class="n">s</span><span class="o">=</span> <span class="mi">80000</span>
<br/></pre></div>
</div>
</div>
</section>
<section id="Overall-Server-Algorithmic-Ceiling">
<h2>Overall Server Algorithmic Ceiling<a class="headerlink" href="#Overall-Server-Algorithmic-Ceiling" title="Link to this heading"></a></h2>
<p>Assume a 1 GIPS machine within infinite cpus, and take IP cost per route, so the number of products that can be routed by a server is going to be inverely related to cost to route each one: route/second = 1000 MIPS / cost to route from previous cell. The other contributor is the number of processes doing the routing.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Application</p></th>
<th class="head"><p>Route/s</p></th>
<th class="head"><p>Routers</p></th>
<th class="head"><p>Total</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PDS</p></td>
<td><p>2000</p></td>
<td><p>1+10</p></td>
<td><p>2000</p></td>
</tr>
<tr class="row-odd"><td><p>Sundew</p></td>
<td><p>5494</p></td>
<td><p>10+10</p></td>
<td><p>54940</p></td>
</tr>
<tr class="row-even"><td><p>Sarracenia</p></td>
<td><p>8000</p></td>
<td><p>10+10</p></td>
<td><p>80000</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>These numbers are algorithmic maxima, never to be seen in real life.</p></li>
<li><p>The Sarracenia one requires a guess at parallelization of Rabbitmq, is conservative.</p></li>
</ul>
</section>
</section>
<section id="Duplicate-Suppression">
<h1>Duplicate Suppression<a class="headerlink" href="#Duplicate-Suppression" title="Link to this heading"></a></h1>
<ul class="simple">
<li><p>All message passing networks implement “Duplicate Suppression”</p></li>
<li><p>typical:</p>
<ul>
<li><p>checksum the message, store the checksums.</p></li>
<li><p>when you get a new message compare it’s checksum to what is in the store.</p></li>
<li><p>if there is a hit, then it’s a duplicate, so discard the message.</p></li>
</ul>
</li>
<li><p>Does not need to be perfect…</p>
<ul>
<li><p>a few duplicates is ok, but need to prevent “storms”</p></li>
</ul>
</li>
<li><p>Simple if one process is handling an entire flow.</p></li>
<li><p>Not simple if &gt; 1 process share the flow.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a fig with a global cache.</span>
<span class="c1"># make a fig here...</span>
<span class="c1"># should have multiple readers for queue...</span>
<span class="c1"># might show multiple subscribers for reading from different pumps.</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Arrow</span><span class="p">,</span> <span class="n">FancyArrow</span><span class="p">,</span> <span class="n">FancyArrowPatch</span>

<span class="k">def</span> <span class="nf">triple_circle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
       <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.9</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.7</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.5</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">)</span>
    <span class="p">]</span>

<span class="k">def</span> <span class="nf">directory_polygon</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">,</span><span class="n">arrow1</span><span class="p">):</span>
   <span class="k">return</span> <span class="p">[</span>
       <span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.2</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.4</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">FancyArrow</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">1.4</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
       <span class="p">]</span>


<span class="k">def</span> <span class="nf">create_base</span><span class="p">(</span><span class="n">box_bg</span> <span class="o">=</span> <span class="s1">&#39;#CCCCCC&#39;</span><span class="p">,</span>
                <span class="n">arrow1</span> <span class="o">=</span> <span class="s1">&#39;#88CCFF&#39;</span><span class="p">,</span>
                <span class="n">arrow2</span> <span class="o">=</span> <span class="s1">&#39;#88FF88&#39;</span><span class="p">,</span>
                <span class="n">supervised</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                 <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

    <span class="n">x</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">y</span><span class="o">=</span><span class="mf">3.6</span>
    <span class="n">patches</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">#patches.extend(directory_polygon(x,y,box_bg,arrow1))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">2.4</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">))</span>
    <span class="n">y</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="c1">#patches.extend(directory_polygon(x,y,box_bg,arrow1))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">2.4</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">))</span>
    <span class="n">y</span><span class="o">=</span><span class="mf">1.8</span>
    <span class="c1">#patches.extend(directory_polygon(x,y,box_bg,arrow1))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">2.4</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="n">box_bg</span><span class="p">))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="n">box_bg</span><span class="p">))</span>

    <span class="nb">len</span><span class="o">=</span><span class="mf">0.5</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">3.4</span><span class="p">,</span><span class="mf">4.4</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.4</span><span class="p">,</span><span class="mf">4.5</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=10.5&quot;</span> <span class="p">),</span>
          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">3.3</span><span class="p">,</span><span class="mf">4.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.3</span><span class="p">,</span><span class="mf">4.3</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=10.5&quot;</span> <span class="p">),</span>
          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">3.2</span><span class="p">,</span><span class="mf">4.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.2</span><span class="p">,</span><span class="mf">4.1</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=10.5&quot;</span> <span class="p">),</span>

          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">6.2</span><span class="p">,</span><span class="mf">4.4</span><span class="p">),</span> <span class="p">(</span><span class="mf">6.2</span><span class="p">,</span><span class="mf">4.5</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=-10.5&quot;</span> <span class="p">),</span>
          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">6.3</span><span class="p">,</span><span class="mf">4.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">6.3</span><span class="p">,</span><span class="mf">4.3</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=-10.5&quot;</span> <span class="p">),</span>
          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">6.2</span><span class="p">,</span><span class="mf">4.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">6.2</span><span class="p">,</span><span class="mf">4.1</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=-10.5&quot;</span> <span class="p">),</span>

          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">6.4</span><span class="p">,</span><span class="mf">3.3</span><span class="p">),</span> <span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">3.4</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=-16.5&quot;</span> <span class="p">),</span>
          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">6.3</span><span class="p">,</span><span class="mf">3.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">6.4</span><span class="p">,</span><span class="mf">3.2</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=-16.5&quot;</span> <span class="p">),</span>
          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">6.2</span><span class="p">,</span><span class="mf">2.9</span><span class="p">),</span> <span class="p">(</span><span class="mf">6.3</span><span class="p">,</span><span class="mf">3.0</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=-16.5&quot;</span> <span class="p">),</span>

          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">3.3</span><span class="p">,</span><span class="mf">3.3</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.2</span><span class="p">,</span><span class="mf">3.4</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=12.5&quot;</span> <span class="p">),</span>
          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">3.3</span><span class="p">,</span><span class="mf">3.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.2</span><span class="p">,</span><span class="mf">3.2</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=12.5&quot;</span> <span class="p">),</span>
          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">3.3</span><span class="p">,</span><span class="mf">2.9</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.2</span><span class="p">,</span><span class="mf">3.0</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=12.5&quot;</span> <span class="p">),</span>

          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">3.1</span><span class="p">,</span><span class="mf">1.6</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.9</span><span class="p">,</span><span class="mf">1.65</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=28&quot;</span> <span class="p">),</span>
          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">3.3</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.1</span><span class="p">,</span><span class="mf">1.55</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=28&quot;</span> <span class="p">),</span>
          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">3.5</span><span class="p">,</span><span class="mf">1.4</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.3</span><span class="p">,</span><span class="mf">1.45</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=28&quot;</span> <span class="p">),</span>

          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">5.9</span><span class="p">,</span><span class="mf">1.6</span><span class="p">),</span> <span class="p">(</span><span class="mf">6.1</span><span class="p">,</span><span class="mf">1.65</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=-28&quot;</span> <span class="p">),</span>
          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">6.1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">6.3</span><span class="p">,</span><span class="mf">1.55</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=-28&quot;</span> <span class="p">),</span>
          <span class="n">FancyArrowPatch</span><span class="p">(</span> <span class="p">(</span><span class="mf">6.3</span><span class="p">,</span><span class="mf">1.4</span><span class="p">),</span> <span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">1.45</span><span class="p">),</span> <span class="n">connectionstyle</span><span class="o">=</span><span class="s2">&quot;arc3,rad=-28&quot;</span> <span class="p">),</span>



          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="nb">len</span><span class="o">+</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.25</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>

          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">5.25</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">5.25</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">5.2</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="nb">len</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">)</span>

        <span class="p">])</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="n">box_bg</span><span class="p">))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="n">box_bg</span><span class="p">))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">box_bg</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patches</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">4.25</span><span class="p">,</span><span class="mf">2.45</span><span class="p">,</span> <span class="s1">&#39;Message&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">4.25</span><span class="p">,</span><span class="mf">2.25</span><span class="p">,</span> <span class="s1">&#39;Broker&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">4.24</span><span class="p">,</span><span class="mf">4.3</span><span class="p">,</span> <span class="s1">&#39;Duplicate&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">4.24</span><span class="p">,</span><span class="mf">4.1</span><span class="p">,</span> <span class="s1">&#39;Suppression&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.2</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span> <span class="s1">&#39;Receiver&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.2</span><span class="p">,</span><span class="mf">2.35</span><span class="p">,</span> <span class="s1">&#39;Receiver&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.2</span><span class="p">,</span><span class="mf">4.15</span><span class="p">,</span> <span class="s1">&#39;Receiver&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">1.05</span><span class="p">,</span> <span class="s1">&#39;Sender&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">2.35</span><span class="p">,</span> <span class="s1">&#39;Sender&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">4.1</span><span class="p">,</span> <span class="s1">&#39;Sender&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">create_base</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">,</span> <span class="s1">&#39;With a Global Cache&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/Contribution_Philosophy_Sarracenia_Algoritmic_Designs_11_0.png" src="../../_images/Contribution_Philosophy_Sarracenia_Algoritmic_Designs_11_0.png" />
</div>
</div>
<section id="Global-Duplication-Suppression">
<h2>Global Duplication Suppression<a class="headerlink" href="#Global-Duplication-Suppression" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>create a service for all the processes participating in a flow to contact.</p></li>
<li><p>ask the service if a partipant has already seen a message with this checksum.</p></li>
<li><p>if the answer is yet, discard the message.</p></li>
<li><p>totally global is the worst case.</p></li>
</ul>
</section>
<section id="Distributed-Duplicate-Suppression">
<h2>Distributed Duplicate Suppression<a class="headerlink" href="#Distributed-Duplicate-Suppression" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>hash the checksum to get a modulo N</p></li>
<li><p>publish the message to an array of destinations modulo the checksum</p></li>
<li><p>a single subscriber on each destination will get 1/N messages.</p></li>
<li><p>Every occurrence of the same message will be sent to the same subscriber.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a fig here...</span>
<span class="c1"># should have multiple readers for queue...</span>
<span class="c1"># might show multiple subscribers for reading from different pumps.</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Arrow</span><span class="p">,</span> <span class="n">FancyArrow</span>

<span class="k">def</span> <span class="nf">triple_circle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
       <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.9</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.7</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.5</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>

       <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.16</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.52</span><span class="p">),</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">),</span>
       <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.36</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.72</span><span class="p">),</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">),</span>
       <span class="n">Circle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.56</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.92</span><span class="p">),</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="p">]</span>

<span class="k">def</span> <span class="nf">directory_polygon</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">,</span><span class="n">arrow1</span><span class="p">):</span>
   <span class="k">return</span> <span class="p">[</span>
       <span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.2</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.4</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">box_bg</span><span class="p">),</span>
       <span class="n">FancyArrow</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">1.4</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
       <span class="p">]</span>


<span class="k">def</span> <span class="nf">create_base</span><span class="p">(</span><span class="n">box_bg</span> <span class="o">=</span> <span class="s1">&#39;#CCCCCC&#39;</span><span class="p">,</span>
                <span class="n">arrow1</span> <span class="o">=</span> <span class="s1">&#39;#88CCFF&#39;</span><span class="p">,</span>
                <span class="n">arrow2</span> <span class="o">=</span> <span class="s1">&#39;#88FF88&#39;</span><span class="p">,</span>
                <span class="n">supervised</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                 <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

    <span class="n">x</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">y</span><span class="o">=</span><span class="mf">3.6</span>
    <span class="n">patches</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">#patches.extend(directory_polygon(x,y,box_bg,arrow1))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">2.4</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">))</span>
    <span class="n">y</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="c1">#patches.extend(directory_polygon(x,y,box_bg,arrow1))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">2.4</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">))</span>
    <span class="n">y</span><span class="o">=</span><span class="mf">1.8</span>
    <span class="c1">#patches.extend(directory_polygon(x,y,box_bg,arrow1))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">2.4</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">box_bg</span><span class="p">))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="n">box_bg</span><span class="p">))</span>
    <span class="nb">len</span><span class="o">=</span><span class="mf">0.5</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.9</span><span class="p">,</span> <span class="nb">len</span><span class="o">+</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.25</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">3.2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>

          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">5.25</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">5.25</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span>
          <span class="n">FancyArrow</span><span class="p">(</span><span class="mf">5.2</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="nb">len</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">arrow1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.11</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.22</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">)</span>

        <span class="p">])</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="n">box_bg</span><span class="p">))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="n">box_bg</span><span class="p">))</span>
    <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">triple_circle</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">box_bg</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patches</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">4.25</span><span class="p">,</span><span class="mf">2.45</span><span class="p">,</span> <span class="s1">&#39;Message&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">4.25</span><span class="p">,</span><span class="mf">2.25</span><span class="p">,</span> <span class="s1">&#39;Broker&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.2</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span> <span class="s1">&#39;Subscriber&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.2</span><span class="p">,</span><span class="mf">2.35</span><span class="p">,</span> <span class="s1">&#39;Subscriber&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.2</span><span class="p">,</span><span class="mf">4.15</span><span class="p">,</span> <span class="s1">&#39;Subscriber&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">1.05</span><span class="p">,</span> <span class="s1">&#39;Sender&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">2.35</span><span class="p">,</span> <span class="s1">&#39;Sender&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">4.1</span><span class="p">,</span> <span class="s1">&#39;Sender&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">create_base</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">,</span> <span class="s1">&#39;Distributed Duplicate Suppression&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">36</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/Contribution_Philosophy_Sarracenia_Algoritmic_Designs_14_0.png" src="../../_images/Contribution_Philosophy_Sarracenia_Algoritmic_Designs_14_0.png" />
</div>
</div>
<p>Each process has it’s own duplicate suppression (the white component within each instance.) As The number of instances grow, the duplicate suppression performance grows naturally. This meets the “embarassingly parallel” goal. but it does cost complexity for analysts to set up.</p>
</section>
<section id="Observations">
<h2>Observations<a class="headerlink" href="#Observations" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>If you are going to use a global cache, it better be really good.</p>
<ul>
<li><p>need to have a scaling architecture for the cache itself.</p></li>
</ul>
</li>
<li><p>If you are using a distributed cache, a fair one is fine.</p>
<ul>
<li><p>scales with the data transmission naturally.</p></li>
<li><p>overall performance is far less sensitive to it’s performance.</p></li>
</ul>
</li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Shared Services Canada, Government of Canada, GPLv2.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>